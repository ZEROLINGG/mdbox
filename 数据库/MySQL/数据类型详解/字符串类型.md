## 1. 定长字符串（CHAR / BINARY）

|             |                |                           |                                                             |
| ----------- | -------------- | ------------------------- | ----------------------------------------------------------- |
| 类型          | 最大长度           | 存储开销                      | 说明                                                          |
| `CHAR(M)`   | 0 ≤ M ≤ 255 字符 | 固定 M × N 字节（N = 每字符最大字节数） | 定长字符类型，不足部分以填充字符（CHAR：空格，BINARY：`\0`<br><br>）补齐。适合长度固定的短文本。 |
| `BINARY(M)` | 0 ≤ M ≤ 255 字节 | 固定 M 字节                   | 定长二进制类型，不做字符集/校对处理，按字节存取。                                   |

- **存储细节**

- 对于多字节字符集（如 utf8mb4，N=4），`CHAR(10)` 最多占 40 字节。
- 行内始终保留全部空间，读写速度稳定。

- **优缺点**

- 访问速度最快，不需存储长度信息

- – 空间浪费（尤其多余填充）、不适合长度差异大的场景

- **示例**

```MySQL
CREATE TABLE codes (
  code CHAR(8)      -- 如固定 8 位的激活码
) CHARSET = utf8mb4;
```

---

## 2. 可变长字符串（VARCHAR / VARBINARY）

|   |   |   |   |
|---|---|---|---|
|类型|最大长度|存储开销|说明|
|`VARCHAR(M)`|0 ≤ M ≤ 65 535 字节（≈64 KB）|L + 1 或 2 字节（L 为实际字节数）|可变字符类型，按实际长度存储，并保留 1 字节（≤255）或 2 字节（＞255）的长度前缀。|
|`VARBINARY(M)`|同 `VARCHAR(M)`|同 `VARCHAR`|可变二进制类型，不做字符集/校对处理。|

- **最大长度限制**

- 单行最大 65 535 字节（含所有列、NULL 标志、长度前缀等开销）。
- 在多字节字符集下，`VARCHAR(16383)` 在 utf8mb4 下最安全（16383×4 ≈ 65532 字节 + 2 字节前缀）。

- **存储与性能**

- 适合长度不定且偏短的文本字段，如用户名、标题。
- 存储节省空间，但读取时需先读前缀获知长度。
- 更新时若新长度超出原空间，可能触发行迁移（性能开销）。

- **示例**

```MySQL
CREATE TABLE users (
  nickname VARCHAR(50)     -- 变长昵称
) CHARSET = utf8mb4;
```

---

## 3. 大对象（TEXT / BLOB）

MySQL 提供四种文本与四种二进制大对象，区别仅在最大长度与存储方式。

|              |                  |              |             |
| ------------ | ---------------- | ------------ | ----------- |
| 类型           | 最大长度             | 存储           | 用途示例        |
| `TINYTEXT`   | 255 字节           | 1 字节长度前缀 + L | 短注释、简短描述    |
| `TEXT`       | 65 535 字节        | 2 字节长度前缀 + L | 中等文本，如文章摘要  |
| `MEDIUMTEXT` | 16 777 215 字节    | 3 字节长度前缀 + L | 大文本，如长篇文章   |
| `LONGTEXT`   | 4 294 967 295 字节 | 4 字节长度前缀 + L | 超大文本，如日志、文档 |
| `TINYBLOB`   | 255 字节           | 同 TINYTEXT   | 小文件、图标      |
| `BLOB`       | 65 535 字节        | 同 TEXT       | 图片、二进制配置    |
| `MEDIUMBLOB` | 16 777 215 字节    | 同 MEDIUMTEXT | 中型文件        |
| `LONGBLOB`   | 4 294 967 295 字节 | 同 LONGTEXT   | 大型文件        |

- **存储机制**

- 默认存储在行外：行内保留 20 字节指针，具体数据页存放实际内容。
- 可通过 `ROW_FORMAT=DYNAMIC/COMPRESSED` 控制短文本是否保留在行内。

- **索引限制**

- 不能对全文字段全文索引（除 FULLTEXT），也不能建立完整索引，只能建立前缀索引：

```MySQL
ALTER TABLE articles
  ADD INDEX idx_title_prefix(title(191));
```

- utf8mb4 下 191 字符 × 4 字节 = 764 字节，接近 InnoDB 默认 767 字节前缀限制。

- **使用场景**

- `TEXT` 系列：存储大量可搜索的文本
- `BLOB` 系列：存储二进制文件，如图片、压缩包

---

## 4. 枚举与集合（ENUM / SET）

|                     |               |                        |                                     |
| ------------------- | ------------- | ---------------------- | ----------------------------------- |
| 类型                  | 可选值数          | 存储开销                   | 说明                                  |
| `ENUM('a','b',...)` | 最多 65 535 个选项 | 1 或 2 字节 （第 N 项存为整数 N） | 值必须从预定义列表中选一个，可节省存储并能做约束；适合少量状态码    |
| `SET('a','b',...)`  | 最多 64 个选项     | 1–8 字节 （位图）            | 值可为多个列表元素的组合，内部按位存储；适合多选标志位，如用户兴趣标签 |

- **优点**

- 存储紧凑，查询时可用 `FIND_IN_SET()` 或位运算判断。
- 约束强，杜绝非法值插入。

- **缺点**

- 扩展字段时需 `ALTER TABLE`，影响表重建与停机维护。
- 在 SQL 以外的环境（如 ORM）支持度参差。

- **示例**

```MySQL
CREATE TABLE products (
  status ENUM('draft','active','archived') NOT NULL DEFAULT 'draft',
  tags   SET('hot','new','sale','limited') NOT NULL
);
```

---

## 5. JSON（可选）

虽然 JSON 属于独立类型，但其本质也是字符串存储优化：

```MySQL
CREATE TABLE configs (
  data JSON NOT NULL
);
```

- **存储**：二进制格式，自动校验合法性
- **索引**：可对虚拟列建立普通索引
- **查询**：支持 `->`、`->>`、`JSON_EXTRACT()` 等丰富函数

---

### 小结与选型建议

1. **短定长**：`CHAR` — 如国家码、固定长度哈希
2. **短可变**：`VARCHAR` — 如姓名、标题
3. **大文本**：`TEXT` / `MEDIUMTEXT` — 如文章正文
4. **二进制**：`VARBINARY` / `BLOB` — 如文件、图片
5. **受限枚举**：`ENUM` / `SET` — 少量固定/多选状态
6. **半结构化**：`JSON` — 灵活配置、日志、事件数据
